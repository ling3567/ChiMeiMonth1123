<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é†«å­¸æ•™è‚²å§”å“¡æœƒå¹´åº¦è¨ˆç•«å¡«å ±</title>
    <!-- è¼‰å…¥ Tailwind CSS ä¸»ç¨‹å¼ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Noto Sans TC å­—é«” -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- 
      å®¢è£½åŒ– Tailwind é¡è‰²
    -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['"Noto Sans TC"', 'sans-serif'],
                    },
                    colors: {
                        'cmh-blue': '#003D74',
                        'cmh-accent': '#00B9E9',
                    }
                }
            }
        }
    </script>
    <style>
        /* éš±è—æ•¸å­—è¼¸å…¥æ¡†çš„ä¸Šä¸‹ç®­é ­ */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            display: flex; 
            flex-direction: column; 
            min-height: 100vh; 
            background-color: #F3F4F6; 
        }
        
        .main-content {
            flex-grow: 1;
        }
        
        label sup {
            color: #EF4444; 
            font-weight: 600;
            font-size: 1rem; 
            margin-left: 0.125rem; 
        }

        /* Spinner */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3); 
            border-top-color: #FFFFFF; 
            animation: spin 0.8s linear infinite;
        }
        
        .modal .spinner {
            border: 3px solid rgba(0, 61, 116, 0.3); 
            border-top-color: #003D74; 
        }

        /* Checkmark */
        @keyframes checkmark {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }
        .checkmark {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #003D74; 
            color: white;
            animation: checkmark 0.3s ease-out;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
        }
        
        /* Modal æ¨£å¼ */
        .modal {
            display: none; 
            animation: fadeIn 0.3s ease-out;
        }
        .modal-content {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* é è¦½å…§å®¹æ¨£å¼ */
        .preview-content h3 {
            font-size: 1.25rem; 
            font-weight: 700; 
            color: #003D74; 
            margin-top: 1.5rem; 
            padding-bottom: 0.5rem; /* æ¨™é¡Œä¸‹æ–¹çš„ç·š */
            border-bottom-width: 2px;
            border-color: #E5E7EB; 
            margin-bottom: 0.5rem; /* ã€â˜…â˜… è¦–è¦ºä¿®æ­£ï¼šæ¸›å°‘æ¨™é¡Œä¸‹æ–¹ç©ºç™½ â˜…â˜…ã€‘ */
        }
        .preview-content p, .preview-content div {
            font-size: 1.125rem; 
            color: #374151; 
            margin-top: 0.5rem; 
            word-break: break-word; 
        }
        .preview-content .plan-block {
            margin-top: 0.5rem; /* ã€â˜…â˜… è¦–è¦ºä¿®æ­£ï¼šæ¸›å°‘å€å¡Šä¸Šæ–¹ç©ºç™½ (åŸæœ¬æ˜¯ 1rem) â˜…â˜…ã€‘ */
            padding: 1rem; 
            background-color: #F9FAFB; 
            border-radius: 0.5rem; 
        }
        
        .preview-content .plan-item {
            display: flex;
            align-items: flex-start; 
            margin-top: 0.5rem; 
        }

        /* ã€â˜…â˜… è¦–è¦ºä¿®æ­£ï¼šç§»é™¤ç¬¬ä¸€å€‹é …ç›®çš„ä¸Šæ–¹é–“è·ï¼Œé¿å…é ‚éƒ¨ç•™ç™½ â˜…â˜…ã€‘ */
        .preview-content .plan-item:first-child {
            margin-top: 0;
        }

        .preview-content .plan-item strong {
            font-weight: 600; 
            color: #1F2937; 
            flex-shrink: 0; 
            width: 170px; 
        }
        .preview-content .plan-item span {
            flex-grow: 1; 
        }
        
        /* é¸æ“‡è³‡æ–™åˆ—è¡¨æ¨£å¼ */
        .data-list-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background-color: #F3F4F6;
            border: 1px solid #E5E7EB;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        .data-list-btn:hover {
            background-color: #E0E7FF;
            border-color: #003D74;
        }
        
    </style>
</head>
<body class="bg-gray-100 text-gray-900">

    <!-- Header å€å¡Š -->
    <header class="relative bg-cmh-blue pb-24 pt-12 text-white">
        <div class="container mx-auto max-w-4xl px-4 text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">é†«å­¸æ•™è‚²å…±è­˜ç‡Ÿ</h1>
            <p class="text-2xl md:text-3xl opacity-90">åŠŸèƒ½å°çµ„å¹´åº¦ç­–ç•¥å¡«å ±</p>
        </div>
        <div class="absolute bottom-0 left-0 w-full h-16 bg-gray-100" style="clip-path: polygon(0 100%, 100% 0, 100% 100%);"></div>
    </header>

    <!-- è¡¨å–®å®¹å™¨ -->
    <div class="main-content container mx-auto max-w-4xl px-4 pb-24">
        
        <form id="dataForm" class="relative -mt-16 bg-white rounded-xl shadow-2xl overflow-hidden">
            
            <div class="p-6 md:p-10 space-y-8">
                
                <!-- ä¸€ã€åŠŸèƒ½å°çµ„åŸºæœ¬è³‡æ–™ -->
                <section class="space-y-4">
                    <h2 class="text-2xl md:text-3xl font-bold text-cmh-blue border-b-2 border-cmh-blue border-opacity-30 pb-2">
                        ä¸€ã€åŠŸèƒ½å°çµ„åŸºæœ¬è³‡æ–™
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="groupName" class="block text-lg font-semibold mb-2 text-gray-700">åŠŸèƒ½å°çµ„åç¨± <sup>*</sup></label>
                            
                            <!-- è¼‰å…¥æŒ‰éˆ• -->
                            <div class="flex flex-col sm:flex-row sm:items-center gap-2">
                                <div class="flex-grow">
                                    <select id="groupName" name="groupName" required
                                        class="w-full text-base md:text-lg px-4 py-3 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue focus:border-transparent transition duration-200">
                                        <option value="" disabled selected>è«‹é¸æ“‡æ‚¨çš„åŠŸèƒ½å°çµ„</option>
                                        <option value="æ•™è‚²è¼”å°çµ„">æ•™è‚²è¼”å°çµ„</option>
                                        <option value="æ•¸ä½è³¦èƒ½çµ„">æ•¸ä½è³¦èƒ½çµ„</option>
                                        <option value="é†«å­¸äººæ–‡çµ„">é†«å­¸äººæ–‡çµ„</option>
                                        <option value="æ ¸å¿ƒèƒ½åŠ›çµ„">æ ¸å¿ƒèƒ½åŠ›çµ„</option>
                                        <option value="æ•™å­¸å“è³ªçµ„">æ•™å­¸å“è³ªçµ„</option>
                                    </select>
                                </div>
                                <button type="button" id="loadDataBtn" class="w-full sm:w-auto whitespace-nowrap px-4 py-3 bg-cmh-accent text-white font-bold rounded-lg hover:bg-opacity-90 transition duration-200 shadow-sm">
                                    ğŸ” æœå°‹/è¼‰å…¥å·²å¡«è³‡æ–™
                                </button>
                            </div>
                            <p id="loadDataMsg" class="text-sm mt-2 text-gray-500 ml-1">å¦‚éœ€ä¿®æ”¹ä¹‹å‰çš„è³‡æ–™ï¼Œè«‹å…ˆé¸æ“‡å°çµ„ä¸¦é»æ“Šæœå°‹ã€‚</p>
                            
                        </div>
                        <div>
                            <label for="reporterName" class="block text-lg font-semibold mb-2 text-gray-700">å ±å‘Šäºº <sup>*</sup></label>
                            <input type="text" id="reporterName" name="reporterName" required
                                class="w-full text-base md:text-lg px-4 py-3 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue focus:border-transparent transition duration-200"
                                placeholder="è«‹å¡«å¯«æ‚¨çš„å§“å">
                        </div>
                    </div>
                </section>

                <!-- äºŒã€åŠŸèƒ½å°çµ„é¡˜æ™¯ -->
                <section class="space-y-4">
                    <h2 class="text-2xl md:text-3xl font-bold text-cmh-blue border-b-2 border-cmh-blue border-opacity-30 pb-2">
                        äºŒã€åŠŸèƒ½å°çµ„é¡˜æ™¯
                    </h2>
                    <div>
                        <label for="vision" class="block text-lg font-semibold mb-2 text-gray-700">è«‹å•ä¸€å¥è©±æè¿°å°çµ„å¸Œæœ›å¥‡ç¾é†«å­¸æ•™è‚²è®Šæˆä»€éº¼æ¨£å­ <sup>*</sup></label>
                        <textarea id="vision" name="vision" rows="3" required
                            class="w-full text-base md:text-lg px-4 py-3 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue focus:border-transparent transition duration-200"
                            placeholder="ã€ç¯„ä¾‹ã€‘&#10;å»ºç«‹ä¸€å¥—èåˆåœ¨åœ°ç‰¹è‰²èˆ‡å€‹äººåŒ–å­¸ç¿’çš„é†«å­¸æ•™è‚²æ¡†æ¶ã€‚"></textarea>
                    </div>
                </section>

                <!-- ä¸‰ã€å¹´åº¦ç›®æ¨™ -->
                <section class="space-y-4">
                    <h2 class="text-2xl md:text-3xl font-bold text-cmh-blue border-b-2 border-cmh-blue border-opacity-30 pb-2">
                        ä¸‰ã€å¹´åº¦ç›®æ¨™
                    </h2>
                    <div>
                        <label for="goals" class="block text-lg font-semibold mb-2 text-gray-700">è«‹å¯«å°çµ„æœªä¾†ä¸€å¹´æœ€é‡è¦çš„ 1â€“3 ä»¶äº‹ï¼Œä¸¦èˆ‡é¡˜æ™¯é€£å‹• <sup>*</sup></label>
                        <textarea id="goals" name="goals" rows="4" required
                            class="w-full text-base md:text-lg px-4 py-3 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue focus:border-transparent transition duration-200"
                            placeholder="ã€ç¯„ä¾‹ã€‘&#10;1. åŸ¹é¤Šå…·å‚™è‡¨åºŠå¯¦å‹™èƒ½åŠ›çš„å­¸å“¡ï¼Œå¼·åŒ–èƒ½åŠ›å°å‘çš„è¨“ç·´å“è³ªã€‚&#10;2. å»ºç«‹æŒçºŒç›£æ¸¬èˆ‡å„ªåŒ–çš„åˆ¶åº¦å¾ªç’°ï¼Œç¢ºä¿æ•™å­¸å“è³ªèˆ‡è©•é‘‘è¦æ±‚ä¸€è‡´ã€‚"></textarea>
                    </div>
                </section>

                <!-- å››ã€å¹´åº¦è¨ˆç•« -->
                <section class="space-y-6">
                    <h2 class="text-2xl md:text-3xl font-bold text-cmh-blue border-b-2 border-cmh-blue border-opacity-30 pb-2">
                        å››ã€å¹´åº¦è¨ˆç•«
                    </h2>
                    <p class="text-base md:text-lg text-gray-600">
                        è«‹å¡«å¯«å…·é«”çš„è¡Œå‹•æ–¹æ¡ˆèˆ‡å¯è¡¡é‡çš„ KPIï¼Œæœ€å¤š 5 é …ã€‚
                    </p>

                    <!-- è¨ˆç•« 1 (å¿…å¡«) -->
                    <div class="space-y-4 p-4 border-2 border-cmh-blue border-opacity-30 rounded-lg bg-gray-50">
                        <h3 class="text-xl font-semibold text-gray-800">è¨ˆç•« 1 (è‡³å°‘éœ€å¡«å¯«ä¸€é …)</h3>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label for="actionName1" class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•åç¨± <sup>*</sup></label>
                                <input type="text" id="actionName1" name="actionName1" required
                                    class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue"
                                    placeholder="ã€ç¯„ä¾‹ã€‘äº”éšæ®µè—åœ–">
                            </div>
                            <div>
                                <label for="actionContent1" class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•å…§å®¹ (ä¸€å¥è©±) <sup>*</sup></label>
                                <input type="text" id="actionContent1" name="actionContent1" required
                                    class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue"
                                    placeholder="ã€ç¯„ä¾‹ã€‘å®Œæˆã€Œå¥ åŸºâ€”ç™¼å±•â€”å¯¦æ–½â€”ç›£æ§â€”å„ªåŒ–ã€äº”éšæ®µæ¨å‹•æ¶æ§‹ä¸¦å•Ÿå‹•ç¤ºç¯„ç§‘åˆ¥å°å…¥ã€‚">
                            </div>
                            <div>
                                <label for="kpi1" class="block text-base font-medium mb-1 text-gray-600">KPI (é‡åŒ–æˆ–å®Œæˆåº¦) <sup>*</sup></label>
                                <input type="text" id="kpi1" name="kpi1" required
                                    class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue"
                                    placeholder="ã€ç¯„ä¾‹ã€‘æ¨å‹•è—åœ–å®Œæˆåº¦ 100%ï¼›è‡³å°‘ 1 ç§‘å®Œæˆç¤ºç¯„å°å…¥ã€‚">
                            </div>
                        </div>
                    </div>

                    <!-- è¨ˆç•« 2-5 (ç•¥ï¼Œä¿æŒåŸæ¨£ï¼Œèˆ‡å‰ç‰ˆç›¸åŒ) -->
                     <div class="space-y-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
                        <h3 class="text-xl font-semibold text-gray-800">è¨ˆç•« 2</h3>
                        <div class="grid grid-cols-1 gap-4">
                            <div><label class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•åç¨±</label><input type="text" id="actionName2" name="actionName2" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘åœ¨åœ°åŒ–èƒ½åŠ›"></div>
                            <div><label class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•å…§å®¹ (ä¸€å¥è©±)</label><input type="text" id="actionContent2" name="actionContent2" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘ç™¼å±•é©ç”¨æ–¼æœ¬é™¢çš„åœ¨åœ°åŒ–èƒ½åŠ›è©•æ ¸é …ç›®..."></div>
                            <div><label class="block text-base font-medium mb-1 text-gray-600">KPI (é‡åŒ–æˆ–å®Œæˆåº¦)</label><input type="text" id="kpi2" name="kpi2" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘è‡³å°‘ 2 é …åœ¨åœ°åŒ–èƒ½åŠ›è‰æ¡ˆå®Œæˆ..."></div>
                        </div>
                    </div>
                    <div class="space-y-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
                        <h3 class="text-xl font-semibold text-gray-800">è¨ˆç•« 3</h3>
                        <div class="grid grid-cols-1 gap-4">
                            <div><label class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•åç¨±</label><input type="text" id="actionName3" name="actionName3" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘å€‹äººåŒ–è¼”å°"></div>
                            <div><label class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•å…§å®¹ (ä¸€å¥è©±)</label><input type="text" id="actionContent3" name="actionContent3" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘å»ºç«‹å³æ™‚å›é¥‹èˆ‡å€‹äººåŒ–å­¸ç¿’è¼”å°æ©Ÿåˆ¶..."></div>
                            <div><label class="block text-base font-medium mb-1 text-gray-600">KPI (é‡åŒ–æˆ–å®Œæˆåº¦)</label><input type="text" id="kpi3" name="kpi3" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘3â€“5 åå­¸å“¡å®Œæˆå€‹äººåŒ–è¼”å°ç¤ºç¯„æ¡ˆä¾‹ã€‚"></div>
                        </div>
                    </div>
                    <div class="space-y-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
                        <h3 class="text-xl font-semibold text-gray-800">è¨ˆç•« 4</h3>
                        <div class="grid grid-cols-1 gap-4">
                            <div><label class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•åç¨±</label><input type="text" id="actionName4" name="actionName4" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘æ•™å­¸å“è³ªå¾ªç’°"></div>
                            <div><label class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•å…§å®¹ (ä¸€å¥è©±)</label><input type="text" id="actionContent4" name="actionContent4" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘å»ºç«‹å¹´åº¦æ•™å­¸å“è³ªç›¤é»ã€ç¨½æ ¸èˆ‡æ”¹å–„æµç¨‹..."></div>
                            <div><label class="block text-base font-medium mb-1 text-gray-600">KPI (é‡åŒ–æˆ–å®Œæˆåº¦)</label><input type="text" id="kpi4" name="kpi4" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘è‡³å°‘60%å–®ä½å®Œæˆå¹´åº¦ç›¤é»ï¼›30%å–®ä½å®Œæˆæ”¹å–„å›é¥‹ã€‚"></div>
                        </div>
                    </div>
                    <div class="space-y-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
                        <h3 class="text-xl font-semibold text-gray-800">è¨ˆç•« 5</h3>
                        <div class="grid grid-cols-1 gap-4">
                            <div><label class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•åç¨±</label><input type="text" id="actionName5" name="actionName5" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘æ•¸ä½å­¸ç¿’å¹³å°"></div>
                            <div><label class="block text-base font-medium mb-1 text-gray-600">è¡Œå‹•å…§å®¹ (ä¸€å¥è©±)</label><input type="text" id="actionContent5" name="actionContent5" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘å„ªåŒ–æ•¸ä½å­¸ç¿’å¹³å°(LMS)åŠŸèƒ½..."></div>
                            <div><label class="block text-base font-medium mb-1 text-gray-600">KPI (é‡åŒ–æˆ–å®Œæˆåº¦)</label><input type="text" id="kpi5" name="kpi5" class="w-full text-base md:text-lg px-4 py-3 bg-white rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue" placeholder="ã€ç¯„ä¾‹ã€‘LMS å„ªåŒ–åŠŸèƒ½ä¸Šç·šå®Œæˆåº¦ 100%ã€‚"></div>
                        </div>
                    </div>

                </section>

                <!-- äº”ã€éœ€è¦çš„æ”¯æŒèˆ‡åˆä½œ -->
                <section class="space-y-4">
                    <h2 class="text-2xl md:text-3xl font-bold text-cmh-blue border-b-2 border-cmh-blue border-opacity-30 pb-2">
                        äº”ã€éœ€è¦çš„æ”¯æŒèˆ‡åˆä½œ
                    </h2>
                    <div>
                        <label for="support" class="block text-lg font-semibold mb-2 text-gray-700">æ‚¨éœ€è¦å“ªäº›æ”¯æŒ (é¸å¡«)</label>
                        <textarea id="support" name="support" rows="4"
                            class="w-full text-base md:text-lg px-4 py-3 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue focus:border-transparent transition duration-200"
                            placeholder="ã€ç¯„ä¾‹ã€‘&#10;1. éœ€å”èª¿å„ç§‘ä¸»ä»»å…±åŒé€²è¡Œèƒ½åŠ›éœ€æ±‚ç›¤é»èˆ‡å°ç„¦ã€‚&#10;2. éœ€è·¨ç§‘æ•™å¸«æŠ•å…¥èƒ½åŠ›é …ç›®è¨è«–èˆ‡è©•ä¼°æ¨™æº–ä¿®è¨‚ã€‚&#10;3. éœ€å”åŠ©å®‰æ’åˆ¶åº¦æ–‡ä»¶å¯©æŸ¥æµç¨‹èˆ‡å…±è­˜ç‡Ÿå‘ˆç¾æ–¹å¼ã€‚"></textarea>
                    </div>
                </section>
                
                <!-- å…­ã€å…¶ä»–è£œå…… -->
                <section class="space-y-4">
                    <h2 class="text-2xl md:text-3xl font-bold text-cmh-blue pb-2">
                        å…­ã€å…¶ä»–è£œå……
                    </h2>
                    <div>
                        <label for="other" class="block text-lg font-semibold mb-2 text-gray-700">å…¶ä»–æ‚¨æƒ³è£œå……çš„è³‡æ–™ (é¸å¡«)</label>
                        <textarea id="other" name="other" rows="4"
                            class="w-full text-base md:text-lg px-4 py-3 bg-gray-50 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue focus:border-transparent transition duration-200"
                            placeholder="ä»»ä½•æœªåœ¨ä¸Šè¿°æ¬„ä½ä¸­ï¼Œä½†æ‚¨å¸Œæœ›åœ¨å ±å‘Šæ™‚å‘ˆç¾çš„è³‡æ–™..."></textarea>
                    </div>
                </section>

            </div>

            <!-- å¡ç‰‡ Footer (æ·ºè‰²) -->
            <footer class="bg-gray-50 px-6 md:px-10 py-6 border-t border-gray-200 sticky bottom-0">
                <div class="flex justify-between items-center">
                    
                    <!-- ç‹€æ…‹è¨Šæ¯ -->
                    <div id="statusMessage" class="text-lg text-gray-600 flex items-center space-x-2">
                        <!-- ç‹€æ…‹å°‡é¡¯ç¤ºæ–¼æ­¤ -->
                    </div>

                    <!-- æäº¤æŒ‰éˆ• (è—åº•ç™½å­—) -->
                    <button type="submit" id="submitButton"
                        class="px-8 py-3 bg-cmh-blue text-white text-lg md:text-xl font-bold rounded-lg shadow-md hover:bg-opacity-90 transition duration-300 focus:outline-none focus:ring-2 focus:ring-cmh-blue focus:ring-opacity-75 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span id="submitButtonText">é è¦½ä¸¦æäº¤</span>
                    </button>
                </div>
            </footer>
        </form>

    </div> <!-- .main-content çµæŸ -->

    <!-- å…¨é  Footer (æ·±è—è‰²) -->
    <footer class="w-full bg-cmh-blue text-white mt-auto relative pt-20"> <!-- å¢åŠ  pt -->
        <!-- åå‘æ–œè§’ (ä½¿ç”¨é é¢èƒŒæ™¯è‰²) -->
        <div class="absolute top-0 left-0 w-full h-20 bg-gray-100" style="clip-path: polygon(0 100%, 100% 0, 0 0);"></div>
        
        <!-- Footer å…§å®¹ -->
        <div class="relative container mx-auto max-w-4xl px-4 py-6 text-center text-gray-300">
            Â© 2025 Chi Mei Medical Center. All rights reserved.
        </div>
    </footer>


    <!-- é è¦½/é¸æ“‡ Modal (å…±ç”¨) -->
    <div id="previewModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <header class="p-6 border-b border-gray-200">
                <h2 id="modalTitle" class="text-3xl font-bold text-cmh-blue">å…§å®¹é è¦½</h2>
                <p id="modalDesc" class="text-lg text-gray-600 mt-1">è«‹ç¢ºèªæ‚¨å¡«å¯«çš„è³‡æ–™æ˜¯å¦æ­£ç¢ºã€‚</p>
            </header>
            
            <div id="previewContent" class="preview-content p-6 overflow-y-auto flex-grow"></div>
            
            <footer class="p-6 bg-gray-50 border-t border-gray-200 flex justify-end items-center space-x-4 rounded-b-xl">
                <span id="modalStatus" class="text-lg text-gray-600 flex-grow flex items-center space-x-2"></span>
                <button type="button" id="cancelButton" class="px-6 py-3 bg-gray-200 text-gray-700 text-lg font-semibold rounded-lg hover:bg-gray-300 transition duration-200">
                    é—œé–‰
                </button>
                <button type="button" id="confirmButton" class="px-6 py-3 bg-cmh-blue text-white text-lg font-bold rounded-lg shadow-md hover:bg-opacity-90 transition duration-300 disabled:opacity-50">
                    <span id="confirmButtonText">ç¢ºèªé€å‡º</span>
                </button>
            </footer>
        </div>
    </div>


    <!-- JavaScript è…³æœ¬ -->
    <script>
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby6HlqKxbzbAdlyNksypmA6krSOSxHZTnTIamFWnSxgc3C6m7Zxb6ANMAkZ0M8ddgw/exec';

        const form = document.getElementById('dataForm');
        const submitButton = document.getElementById('submitButton');
        const statusMessage = document.getElementById('statusMessage');

        // Modal å…ƒç´ 
        const previewModal = document.getElementById('previewModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalDesc = document.getElementById('modalDesc');
        const previewContent = document.getElementById('previewContent');
        const cancelButton = document.getElementById('cancelButton');
        const confirmButton = document.getElementById('confirmButton');
        const confirmButtonText = document.getElementById('confirmButtonText');
        const modalStatus = document.getElementById('modalStatus');

        // è¼‰å…¥æŒ‰éˆ•
        const loadDataBtn = document.getElementById('loadDataBtn');
        const groupNameSelect = document.getElementById('groupName');
        const loadDataMsg = document.getElementById('loadDataMsg');

        let formDataObject = {}; 
        let fetchedDataCache = []; // æš«å­˜æŠ“å›ä¾†çš„è³‡æ–™

        // é—œé–‰ Modal
        cancelButton.addEventListener('click', () => {
            previewModal.style.display = 'none';
        });

        // ã€åŠŸèƒ½ï¼šè¼‰å…¥è³‡æ–™ã€‘
        loadDataBtn.addEventListener('click', function() {
            const selectedGroup = groupNameSelect.value;
            if (!selectedGroup) {
                loadDataMsg.textContent = 'è«‹å…ˆé¸æ“‡åŠŸèƒ½å°çµ„ã€‚';
                loadDataMsg.className = 'text-sm mt-1 text-red-500';
                return;
            }

            loadDataMsg.textContent = 'æ­£åœ¨æœå°‹è³‡æ–™...';
            loadDataMsg.className = 'text-sm mt-1 text-cmh-blue';
            loadDataBtn.disabled = true;

            // Fetch Data
            const script = document.createElement('script');
            const callbackName = 'handleLoadData';
            script.src = `${GOOGLE_APPS_SCRIPT_URL}?callback=${callbackName}&_=${new Date().getTime()}`;
            
            window.handleLoadData = function(data) {
                document.body.removeChild(script);
                loadDataBtn.disabled = false;
                delete window.handleLoadData;

                if (data && data.length > 0) {
                    // ç¯©é¸å‡ºè©²çµ„åˆ¥çš„è³‡æ–™
                    const groupReports = data.filter(row => row.groupName === selectedGroup);
                    
                    if (groupReports.length === 0) {
                        loadDataMsg.textContent = `ç›®å‰é‚„æ²’æœ‰ ${selectedGroup} çš„è³‡æ–™ã€‚`;
                        loadDataMsg.className = 'text-sm mt-1 text-orange-500';
                    } else {
                        loadDataMsg.textContent = ''; // æ¸…é™¤è¨Šæ¯
                        fetchedDataCache = groupReports;
                        showSelectionModal(selectedGroup, groupReports); // é¡¯ç¤ºé¸æ“‡è¦–çª—
                    }
                } else {
                    loadDataMsg.textContent = 'ç›®å‰æ²’æœ‰ä»»ä½•è³‡æ–™ã€‚';
                    loadDataMsg.className = 'text-sm mt-1 text-gray-500';
                }
            };

            script.onerror = function() {
                 document.body.removeChild(script);
                 loadDataBtn.disabled = false;
                 loadDataMsg.textContent = 'è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚';
                 loadDataMsg.className = 'text-sm mt-1 text-red-600';
                 delete window.handleLoadData;
            };

            document.body.appendChild(script);
        });

        // é¡¯ç¤ºã€Œé¸æ“‡è³‡æ–™ã€çš„ Modal
        function showSelectionModal(groupName, reports) {
            modalTitle.textContent = `é¸æ“‡è¦è¼‰å…¥çš„è³‡æ–™ (${groupName})`;
            modalDesc.textContent = `æ‰¾åˆ° ${reports.length} ç­†è³‡æ–™ï¼Œè«‹é¸æ“‡ä¸€ç­†è¼‰å…¥ä»¥é€²è¡Œä¿®æ”¹ï¼š`;
            
            let html = '<div class="space-y-3">';
            reports.forEach((report, index) => {
                // é¡¯ç¤º å ±å‘Šäºº + æ™‚é–“ (å¦‚æœæœ‰çš„è©±)
                const time = report.timestamp ? report.timestamp.split(' ')[0] : 'æœªçŸ¥æ™‚é–“';
                html += `
                    <button type="button" class="data-list-btn w-full text-left p-4 bg-gray-100 hover:bg-blue-50 border border-gray-300 rounded-lg transition duration-200 flex justify-between items-center" onclick="loadSelectedData(${index})">
                        <div>
                            <span class="font-bold text-lg text-cmh-blue">${report.reporterName}</span>
                            <span class="text-sm text-gray-500 ml-2">æäº¤æ–¼: ${report.timestamp || 'æœªçŸ¥'}</span>
                        </div>
                        <span class="text-cmh-accent font-semibold">è¼‰å…¥ &rarr;</span>
                    </button>
                `;
            });
            html += '</div>';
            
            previewContent.innerHTML = html;
            
            // éš±è—ã€Œç¢ºèªé€å‡ºã€æŒ‰éˆ•ï¼Œåªç•™ã€Œé—œé–‰ã€
            confirmButton.style.display = 'none';
            cancelButton.textContent = 'å–æ¶ˆ';
            
            previewModal.style.display = 'flex';
        }

        // è¼‰å…¥é¸å®šçš„è³‡æ–™åˆ°è¡¨å–®
        window.loadSelectedData = function(index) {
            const data = fetchedDataCache[index];
            if (!data) return;
            
            // å¡«å…¥è³‡æ–™ (å¼·åˆ¶è½‰å­—ä¸²)
            document.getElementById('reporterName').value = String(data.reporterName || '');
            document.getElementById('vision').value = String(data.vision || '');
            document.getElementById('goals').value = String(data.goals || '');
            
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`actionName${i}`).value = String(data[`actionName${i}`] || '');
                document.getElementById(`actionContent${i}`).value = String(data[`actionContent${i}`] || '');
                document.getElementById(`kpi${i}`).value = String(data[`kpi${i}`] || '');
            }
            
            document.getElementById('support').value = String(data.support || '');
            document.getElementById('other').value = String(data.other || '');
            
            // é—œé–‰ Modal
            previewModal.style.display = 'none';
            loadDataMsg.textContent = `å·²è¼‰å…¥ï¼š${data.reporterName}`;
            loadDataMsg.className = 'text-sm mt-1 text-green-600 font-semibold';
            
            // æ¢å¾© Modal åŸå§‹ç‹€æ…‹ (çµ¦é è¦½ç”¨)
            confirmButton.style.display = 'inline-flex';
            cancelButton.textContent = 'è¿”å›ä¿®æ”¹';
        };


        // ä¸»æäº¤æŒ‰éˆ• (é»æ“Šé è¦½)
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            
            if (!form.checkValidity()) {
                statusMessage.innerHTML = '<span class="text-red-500 font-semibold">è«‹å¡«å¯«æ‰€æœ‰ <sup>*</sup> å¿…å¡«æ¬„ä½ã€‚</span>';
                form.reportValidity();
                return;
            }
            statusMessage.innerHTML = '';
            
            const formData = new FormData(form);
            formDataObject = {};
            formData.forEach((value, key) => {
                formDataObject[key] = value;
            });

            // é‡ç½® Modal ç‚ºé è¦½æ¨¡å¼
            modalTitle.textContent = 'å…§å®¹é è¦½';
            modalDesc.textContent = 'è«‹ç¢ºèªæ‚¨å¡«å¯«çš„è³‡æ–™æ˜¯å¦æ­£ç¢ºã€‚';
            confirmButton.style.display = 'inline-flex';
            confirmButton.disabled = false;
            confirmButtonText.textContent = 'ç¢ºèªé€å‡º';
            cancelButton.textContent = 'è¿”å›ä¿®æ”¹';
            modalStatus.innerHTML = '';
            
            // ç¶å®šé€å‡ºäº‹ä»¶
            confirmButton.onclick = () => submitData(formDataObject);

            previewContent.innerHTML = generatePreviewHTML(formDataObject);
            previewModal.style.display = 'flex';
        });

        
        // (è¼”åŠ©å‡½æ•¸çœç•¥ï¼Œä¿æŒåŸæ¨£)
        const formatText = (text) => {
            if (!text || text.trim() === '') return '<span class="text-gray-400">ç„¡</span>';
            return text.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, '<br>');
        };

        const createPlanItem = (label, content) => {
            if (!content || content.trim() === '') return '';
            const encodedContent = content.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, '<br>');
            return `<div class="plan-item"><strong>${label}:</strong><span>${encodedContent}</span></div>`;
        };
        
        function generatePreviewHTML(data) {
            let plansHtml = '';
            for (let i = 1; i <= 5; i++) {
                const name = data[`actionName${i}`];
                const content = data[`actionContent${i}`];
                const kpi = data[`kpi${i}`];
                
                const nameHtml = createPlanItem(`è¡Œå‹•åç¨± ${i}`, name);
                const contentHtml = createPlanItem(`è¡Œå‹•å…§å®¹ ${i}`, content);
                const kpiHtml = createPlanItem(`KPI ${i}`, kpi);

                if (nameHtml || contentHtml || kpiHtml) {
                    plansHtml += `<div class="plan-block">${nameHtml}${contentHtml}${kpiHtml}</div>`;
                }
            }
            if (plansHtml === '') plansHtml = `<div><span class="text-gray-400">ç„¡</span></div>`;

            return `
                <h3>ä¸€ã€åŠŸèƒ½å°çµ„åŸºæœ¬è³‡æ–™</h3>
                <p><strong>åŠŸèƒ½å°çµ„åç¨±:</strong> ${formatText(data.groupName)}</p>
                <p><strong>å ±å‘Šäºº:</strong> ${formatText(data.reporterName)}</p>
                <h3>äºŒã€åŠŸèƒ½å°çµ„é¡˜æ™¯</h3><p>${formatText(data.vision)}</p>
                <h3>ä¸‰ã€å¹´åº¦ç›®æ¨™</h3><div>${formatText(data.goals)}</div>
                <h3>å››ã€å¹´åº¦è¨ˆç•«</h3>${plansHtml}
                <h3>äº”ã€éœ€è¦çš„æ”¯æŒèˆ‡åˆä½œ</h3><div>${formatText(data.support)}</div>
                <h3>å…­ã€å…¶ä»–è£œå……</h3><div>${formatText(data.other)}</div>
            `;
        }

        function submitData(data) {
            confirmButton.disabled = true;
            confirmButtonText.textContent = 'æäº¤ä¸­...';
            modalStatus.innerHTML = '<div class="spinner"></div><span> å‚³é€è³‡æ–™...</span>';

            data.timestamp = new Date().toLocaleString("zh-TW", { timeZone: "Asia/Taipei" });
            
            fetch(GOOGLE_APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                body: new URLSearchParams(data),
            })
            .then(() => {
                modalStatus.innerHTML = '<div class="checkmark">âœ“</div><span class="text-cmh-blue font-semibold"> æäº¤æˆåŠŸï¼</span>';
                confirmButtonText.textContent = 'å·²æäº¤';
                
                cancelButton.style.display = 'none'; 
                
                confirmButton.disabled = false;
                confirmButtonText.textContent = 'é—œé–‰';
                
                // ã€â˜…â˜… é—œéµä¿®æ­£ (gen_56)ï¼šæˆåŠŸå¾Œï¼Œå°‡ onclick æ›¿æ›ç‚º "é—œé–‰" è¡Œç‚º â˜…â˜…ã€‘
                confirmButton.onclick = () => { 
                    previewModal.style.display = 'none';
                    form.reset(); // æ¸…ç©ºè¡¨å–®
                    
                    statusMessage.innerHTML = '<span class="text-green-600 font-semibold">âœ“ è³‡æ–™å·²æˆåŠŸæäº¤ã€‚</span>';
                    window.scrollTo(0, 0); // æ»¾å‹•åˆ°æœ€ä¸Šæ–¹
                    
                    // æ¢å¾©æŒ‰éˆ•åŸå§‹ç‹€æ…‹ (ä»¥ä¾¿ä¸‹ä¸€æ¬¡ä½¿ç”¨)
                    cancelButton.style.display = 'inline-flex';
                    // æ³¨æ„ï¼šä¸éœ€è¦æ‰‹å‹•ç¶å› submitDataï¼Œä¸‹æ¬¡ form submit æœƒè‡ªå‹•åš
                };

            })
            .catch(error => {
                // 5. ç¶²è·¯æ–·ç·šç­‰éŒ¯èª¤
                console.error('æäº¤éŒ¯èª¤:', error);
                
                modalStatus.innerHTML = `<span class="text-red-600">æäº¤å¤±æ•— (ç¶²è·¯éŒ¯èª¤): ${error.message}</span>`;
                confirmButton.disabled = false;
                confirmButtonText.textContent = 'é‡æ–°æäº¤';
            });
        }
    </script>

</body>
</html>
