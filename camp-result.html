<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã€Œå‰µé€ 360Â°äººç”Ÿã€é†«å­¸æ•™è‚²å…±è­˜ç‡Ÿ æˆæ•ˆåˆ†æå„€è¡¨æ¿</title>
  
  <!-- å‡½å¼åº« -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <!-- å¼•å…¥ FontAwesome ç”¨æ–¼åœ–ç¤º -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      /* --- è¨±æ–‡é¾ç•«ä½œè‰²ç³»æå– --- */
      --bg-paper: #F9F7F2;
      --bg-warm-gradient: linear-gradient(to bottom, #FBF9F6 0%, #F0ECE6 100%);
      --card-bg: #FFFFFF;
      --card-border: #E6E0D6;
      --card-shadow: 0 6px 24px rgba(74, 64, 58, 0.05);
      --primary: #A65E4E; 
      --primary-light: rgba(166, 94, 78, 0.08);
      --secondary-blue: #2A5F8E;
      --accent-purple: #7D6586;
      --text-main: #2C2420; 
      --text-muted: #6B635F;
      --success: #5D9C59;
      --warning: #D4A017;
      --danger: #e11d48;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-size: 18px; 
      /* å¼·åˆ¶æŒ‡å®šå¾®è»Ÿæ­£é»‘é«” */
      font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif !important;
      background: var(--bg-warm-gradient);
      color: var(--text-main);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.8;
      letter-spacing: 0.04em;
    }

    h1, h2, h3, .hero-title, .section-title, .stat-value, .insight-title, .insight-highlight, .stat-narrative-title, .stat-tag-pill, .core, .likert-title, .suggestion-title, .keyword-tag, .lhs-title {
      font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif !important;
      letter-spacing: 0.06em;
    }

    .page {
      max-width: 1280px;
      margin: 0 auto;
      padding: 48px 32px 96px;
    }

    /* Hero Section */
    header.hero {
      position: relative;
      padding: 64px 56px;
      border-radius: 28px;
      background-color: #fff;
      background-image: radial-gradient(#A65E4E 0.5px, transparent 0.5px), radial-gradient(#A65E4E 0.5px, #fff 0.5px);
      background-size: 24px 24px;
      background-position: 0 0, 12px 12px;
      background: linear-gradient(to right, rgba(255,255,255,0.96), rgba(253,250,245,0.88));
      border: 1px solid var(--card-border);
      box-shadow: var(--card-shadow);
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 56px;
      align-items: center;
    }

    @media (max-width: 900px) {
      header.hero { grid-template-columns: 1fr; text-align: center; padding: 48px 32px; }
      .hero-visual { display: none; }
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 8px 20px;
      border-radius: 99px;
      background: var(--primary-light);
      border: 1px solid rgba(166, 94, 78, 0.2);
      font-size: 16px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 28px;
      letter-spacing: 0.08em;
    }

    .chip-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--primary);
    }

    .hero-title {
      font-size: clamp(40px, 6vw, 60px);
      font-weight: 900; /* ç‰¹ç²—é«” */
      line-height: 1.3;
      margin: 0 0 24px;
      color: #1a1a1a;
      text-shadow: 2px 2px 0px rgba(255,255,255,0.5);
    }
    
    .hero-title span {
      color: var(--primary);
      position: relative;
      display: inline-block;
      margin: 0 6px;
    }
    
    .hero-title span::after {
      content: '';
      position: absolute;
      bottom: 8px;
      left: 0;
      width: 100%;
      height: 14px;
      background: rgba(166, 94, 78, 0.15);
      z-index: -1;
      border-radius: 4px;
    }

    .hero-subtitle {
      font-size: 20px;
      color: var(--text-muted);
      line-height: 1.8;
      max-width: 760px;
      margin-bottom: 0;
      font-weight: 600; /* åŠ ç²— */
    }

    /* Hero Visual */
    .hero-visual {
      position: relative;
      width: 200px;
      height: 200px;
    }
    .orbit {
      position: absolute;
      inset: 0;
      border: 3px dashed var(--primary); 
      border-radius: 50%;
      opacity: 0.25;
      animation: spin 30s linear infinite;
    }
    .core {
      position: absolute;
      inset: 24px;
      background: #fff;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      border: 1px solid var(--card-border);
      box-shadow: 0 8px 24px rgba(166, 94, 78, 0.1);
    }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* Stats Grid */
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 28px;
      margin-top: 56px;
    }

    .stat-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: 32px;
      position: relative;
      transition: all 0.3s ease;
      box-shadow: var(--card-shadow);
    }
    .stat-card:hover { 
      transform: translateY(-4px); 
      box-shadow: 0 12px 30px rgba(74, 64, 58, 0.1);
      border-color: rgba(166, 94, 78, 0.3);
    }

    .stat-label { 
      font-size: 18px;
      color: var(--text-muted); 
      margin-bottom: 12px; 
      font-weight: 700;
    }
    .stat-value { 
      font-size: 56px;
      font-weight: 800; 
      color: var(--text-main); 
      line-height: 1;
    }
    .stat-unit { 
      font-size: 18px; 
      color: var(--text-muted); 
      font-weight: 500; 
      margin-left: 8px; 
    }
    .stat-badge {
      position: absolute; top: 28px; right: 28px;
      font-size: 14px; padding: 6px 14px;
      border-radius: 99px; 
      background: #F5F2ED;
      color: var(--text-muted);
      font-weight: 700;
    }

    /* Section Headers */
    .section { margin-top: 80px; }
    .section-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 32px; flex-wrap: wrap; gap: 20px;}
    .section-title { 
      font-size: 32px;
      font-weight: 800; 
      color: var(--text-main); 
      display: flex; align-items: center; gap: 16px; 
    }
    .section-title::before { 
      content: ''; width: 8px; height: 36px; 
      background: var(--primary); 
      border-radius: 4px; display: block; 
    }
    .section-desc { font-size: 18px; color: var(--text-muted); max-width: 700px; margin-bottom: 4px; }

    @media (max-width: 768px) {
      .section { margin-top: 48px; }
      .section-title { font-size: 24px; }
      .section-title::before { height: 28px; width: 6px; }
      .section-desc { font-size: 15px; }
    }

    /* Charts & Interactive Cards */
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 24px;
      padding: 40px;
      box-shadow: var(--card-shadow);
    }
    .card-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 10px;
    }
    .card-title {
      font-size: 24px; font-weight: 700; color: var(--text-main);
    }
    .card-subtitle {
      font-size: 16px; color: var(--text-muted);
    }
    .card-tag {
      font-size: 14px; padding: 6px 16px; border-radius: 99px;
      background: #F5F2ED; color: var(--text-muted); font-weight: 600; white-space: nowrap;
    }

    @media (max-width: 768px) {
      .card { padding: 24px; }
      .card-title { font-size: 20px; }
      .card-header { align-items: flex-start; }
    }

    .chart-container { position: relative; height: 420px; width: 100%; }

    /* Question Explorer Grid */
    .likert-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }
    @media (max-width: 768px) {
      .likert-grid { grid-template-columns: 1fr; gap: 16px; }
    }

    .likert-card {
      background: #fff;
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--card-shadow);
      display: flex;
      flex-direction: column;
      gap: 16px;
      transition: transform 0.2s;
    }
    .likert-card:hover {
      transform: translateY(-4px);
      border-color: var(--primary-light);
    }

    .likert-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-main);
      line-height: 1.4;
      min-height: 50px; 
    }

    .likert-subtitle {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .question-group-pill {
      font-size: 13px;
      padding: 4px 12px;
      border-radius: 99px;
      background: var(--primary-light);
      color: var(--primary);
      font-weight: 600;
    }

    .pill-info-solid {
      font-size: 13px;
      padding: 4px 12px;
      border-radius: 99px;
      background: #F5F2ED;
      color: var(--text-muted);
      font-weight: 600;
      border: 1px solid #EBE6DF;
    }

    /* Color Legend */
    .color-legend {
      display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px;
    }
    .legend-item {
      display: flex; align-items: center; gap: 6px; font-size: 14px; color: #475569; font-weight: 500;
    }
    .legend-dot {
      width: 10px; height: 10px; border-radius: 50%;
    }

    .mini-chart-container {
      position: relative;
      height: 200px;
      width: 100%;
    }

    /* LHS / Action List Styles */
    .action-list {
      list-style: none; padding: 0; margin: 0;
      display: flex; flex-direction: column; gap: 20px;
    }
    
    .action-item {
      display: flex; gap: 20px; align-items: flex-start;
      padding-bottom: 20px; border-bottom: 1px solid #EBE6DF;
    }
    .action-item:last-child { border-bottom: none; padding-bottom: 0; }

    .knowledge-num {
      flex-shrink: 0; width: 40px; height: 40px; 
      background: rgba(212, 160, 23, 0.1); color: var(--warning);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 20px;
    }
    
    .practice-icon {
      flex-shrink: 0; width: 40px; height: 40px; 
      background: rgba(42, 95, 142, 0.1); color: var(--secondary-blue);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }

    .action-content {
      flex-grow: 1;
    }
    .action-content strong {
      display: block; font-size: 20px; font-weight: 700; color: var(--text-main);
      margin-bottom: 6px;
    }
    .action-content p {
      margin: 0; font-size: 18px; color: #5C524B; line-height: 1.6;
    }
    
    /* LHS Introduction Card */
    .lhs-intro {
      background: linear-gradient(to right, #FDFBF7, #FFF);
      border: 1px solid #E6E0D6;
      border-radius: 20px;
      padding: 32px;
      margin-bottom: 32px;
      display: flex; gap: 24px; align-items: flex-start;
    }
    .lhs-intro-icon {
      width: 64px; height: 64px; border-radius: 50%; background: #fff;
      border: 1px solid #E6E0D6; color: var(--primary);
      display: flex; align-items: center; justify-content: center; font-size: 28px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05); flex-shrink: 0;
    }
    @media (max-width: 768px) {
       .lhs-intro { flex-direction: column; padding: 24px; gap: 16px; }
       .lhs-intro-icon { width: 48px; height: 48px; font-size: 20px; }
    }

    /* LHS Grid */
    .lhs-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 24px;
    }
    @media (max-width: 900px) { .lhs-grid { grid-template-columns: 1fr; } }

    .lhs-card {
      background: #fff;
      border-radius: 16px;
      padding: 28px;
      box-shadow: var(--card-shadow);
      border: 1px solid var(--card-border);
      border-top-width: 6px; 
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .lhs-step-title {
      font-size: 20px; font-weight: 800; margin-bottom: 20px;
      display: flex; align-items: center; gap: 10px;
    }

    .lhs-data-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 0; border-bottom: 1px solid #F1F5F9;
    }
    .lhs-data-item:last-child { border-bottom: none; }
    .lhs-data-label { color: #64748B; font-size: 16px; }
    .lhs-data-val { font-weight: 700; font-size: 18px; color: #0F172A; }

    .lhs-highlight {
      background: #F8FAFC; padding: 16px; border-radius: 8px; margin-bottom: 16px;
    }
    .lhs-highlight-label { font-size: 14px; color: #64748B; font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
    .lhs-highlight-val { font-size: 18px; font-weight: 700; color: #334155; }

    .lhs-action-list { list-style: none; padding: 0; margin: 0; }
    .lhs-action-item {
      display: flex; gap: 12px; margin-bottom: 16px; align-items: flex-start;
    }
    .lhs-action-icon {
      width: 24px; height: 24px; border-radius: 50%; background: #E2E8F0; 
      display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 12px; color: #475569;
    }
    .lhs-action-text { font-size: 16px; color: #334155; line-height: 1.5; }

    .lhs-footer {
      margin-top: 32px;
      background: #FFF;
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 28px;
      border-left: 6px solid var(--success);
    }

    /* Qualitative Tabs & Content */
    .quote-tabs {
      display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;
    }
    .quote-tab {
      padding: 8px 16px; border-radius: 99px; border: 1px solid #E2E8F0;
      background: #fff; color: #64748B; cursor: pointer; font-weight: 600; font-size: 14px;
      transition: all 0.2s;
    }
    .quote-tab.active {
      background: #ECFDF5; color: #059669; border-color: #10B981;
    }
    .quote-tab:hover:not(.active) { background: #F8FAFC; }

    .keyword-cloud {
      display: flex; flex-wrap: wrap; gap: 12px;
    }
    .keyword-tag {
      padding: 8px 18px; border-radius: 50px; font-size: 16px; font-weight: 600;
      background: #F3F4F6; color: #4B5563; border: 1px solid #E5E7EB;
    }
    .keyword-tag.hot { background: #FEF2F2; color: #DC2626; border-color: #FECACA; }

    .quote-scroll {
      max-height: 300px; overflow-y: auto; padding-right: 12px;
    }
    .quote-item {
      padding: 16px 0; border-bottom: 1px solid #eee; font-size: 16px; color: #4b5563; line-height: 1.6;
    }
    .quote-item:last-child { border-bottom: none; }

    /* Statistical Narrative Block */
    .stat-narrative-box {
      margin-top: 36px;
      border-top: 1px solid #EBE6DF;
      padding-top: 24px;
    }
    
    .stat-insight-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }
    @media (max-width: 768px) { .stat-insight-grid { grid-template-columns: 1fr; } }
    
    .stat-insight-item {
      background: #F9F9F9;
      border: 1px solid #EBE6DF;
      border-radius: 12px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .stat-insight-label {
      font-size: 14px;
      color: #6B635F;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .stat-insight-content {
      font-size: 16px;
      color: #2C2420;
      font-weight: 500;
    }
    
    .stat-insight-sub {
      font-size: 14px;
      color: #8C8279;
    }

    .best-perf-box {
      background: rgba(166, 94, 78, 0.08); 
      border-left: 4px solid var(--primary);
      padding: 16px 20px;
      border-radius: 4px;
      margin-bottom: 20px;
      color: var(--primary);
      font-weight: 700;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* Loading Overlay */
    #loading-overlay {
      position: fixed; inset: 0;
      background: #F9F7F2;
      z-index: 1000;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      transition: opacity 0.5s;
    }
    .spinner {
      width: 64px; height: 64px;
      border: 5px solid rgba(166, 94, 78, 0.2);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 24px;
    }

    footer { 
      text-align: center; padding: 64px 0 32px; 
      color: var(--text-muted); font-size: 16px; 
      border-top: 1px solid #EBE6DF;
      margin-top: 96px;
    }

  </style>
</head>
<body>

  <!-- Loading -->
  <div id="loading-overlay">
    <div class="spinner"></div>
    <div style="color: #8C8279; font-size: 20px; letter-spacing: 2px; font-weight: 700;">æ­£åœ¨è®€å–å…±è­˜ç‡Ÿæ•¸æ“š...</div>
  </div>

  <div class="page">
    
    <!-- Hero -->
    <header class="hero">
      <div>
        <div class="chip">
          <span class="chip-dot"></span>
          <span>114å¹´11æœˆ23æ—¥è¾¦ç†</span>
        </div>
        <h1 class="hero-title">
          ã€Œå‰µé€ <span>360Â°</span>äººç”Ÿã€<br>
          é†«å­¸æ•™è‚²å…±è­˜ç‡Ÿï½œ<br>
          æˆæ•ˆåˆ†æå„€è¡¨æ¿
        </h1>
        <p class="hero-subtitle">
          æœ¬å ±å‘Šå³æ™‚é€£çµ Google Sheet åŸå§‹æ•¸æ“šï¼Œå‘ˆç¾äº”å¤§æ ¸å¿ƒèƒ½åŠ›æŒ‡æ¨™èˆ‡æ´»å‹•æ»¿æ„åº¦çš„çµ±è¨ˆåˆ†æã€‚é€éæ•¸æ“šæ´å¯Ÿï¼Œæˆ‘å€‘æŒçºŒå„ªåŒ–æ•™å­¸èˆ‡å‚³æ‰¿çš„æ¯ä¸€å€‹ç’°ç¯€ã€‚
        </p>
      </div>
      <div class="hero-visual">
        <div class="orbit"></div>
        <div class="core">
          <div style="font-size: 42px; font-weight: 800; color: var(--primary);">N=<span id="hero-n">--</span></div>
          <div style="font-size: 16px; color: var(--text-muted); font-weight: 600;">æœ‰æ•ˆå•å·</div>
        </div>
      </div>
    </header>

    <!-- Stats Overview -->
    <div class="stat-grid">
      <div class="stat-card">
        <div class="stat-badge">å•å·å›æ”¶</div>
        <div class="stat-label">ç¸½å¡«ç­”äººæ•¸</div>
        <div class="stat-value"><span id="stat-n">--</span><span class="stat-unit">äºº</span></div>
      </div>
      <div class="stat-card">
        <div class="stat-badge">å¹³å‡æ»¿æ„åº¦</div>
        <div class="stat-label">æ•´é«”æ´»å‹•è©•åƒ¹</div>
        <div class="stat-value"><span id="stat-sat">--</span><span class="stat-unit">/ 5.0</span></div>
      </div>
      <div class="stat-card">
        <div class="stat-badge">å¾—åˆ†äº®é»</div>
        <div class="stat-label">è¡¨ç¾æœ€ä½³æ§‹é¢</div>
        <div class="stat-value" style="font-size: 28px; color: var(--primary);" id="stat-best">è¨ˆç®—ä¸­...</div>
      </div>
      <div class="stat-card">
        <div class="stat-badge">èªåŒåº¦</div>
        <div class="stat-label">é¡˜æ„æ¨è–¦ä»–äºº</div>
        <div class="stat-value"><span id="stat-recommend">--</span><span class="stat-unit">%</span></div>
      </div>
    </div>

    <!-- Section 1: Effectiveness Analysis -->
    <section class="section">
      <div class="section-header">
        <div>
          <div class="section-title" style="color: var(--secondary-blue);">äº”å¤§æ ¸å¿ƒæ§‹é¢æˆæ•ˆåˆ†æ</div>
          <div class="section-desc">å­¸ç¿’ã€åæ€ã€è¡Œç‚ºã€è®Šé©èˆ‡èªåŒçš„æˆæ•ˆè©•ä¼°ã€‚</div>
        </div>
      </div>
      <div class="card">
        <div class="chart-container">
          <canvas id="effectivenessChart"></canvas>
        </div>
        <div id="stat-narrative-content" class="stat-narrative-box">
          <!-- JS will populate simplified stats here -->
        </div>
      </div>
    </section>

    <!-- Section 2: Satisfaction Analysis -->
    <section class="section">
      <div class="section-header">
        <div>
          <div class="section-title" style="color: var(--accent-purple);">æ´»å‹•æ»¿æ„åº¦æˆæ•ˆåˆ†æ</div>
          <div class="section-desc">é‡å°æ•´é«”å®‰æ’ã€è­°ç¨‹å…§å®¹ã€å­¸ç¿’éœ€æ±‚èˆ‡å¿ƒç†å®‰å…¨ä¹‹çµ±è¨ˆåˆ†æã€‚</div>
        </div>
      </div>
      <div class="card">
        <div class="chart-container">
          <canvas id="satisfactionChart"></canvas>
        </div>
        <div id="sat-narrative-content" class="stat-narrative-box">
          <!-- JS will populate simplified stats here -->
        </div>
      </div>
    </section>

    <!-- Section 3: Question Explorer -->
    <section class="section" id="questions">
      <div class="section-header">
        <div>
          <div class="section-title" style="color: var(--text-main);">é¡Œç›®äº’å‹•åˆ†æ (Question Explorer)</div>
          <div class="section-desc">å–®é¡Œæ·±åº¦åˆ†æï¼ŒåŒ…å«å¹³å‡åˆ†èˆ‡è©•åˆ†åˆ†ä½ˆã€‚</div>
        </div>
      </div>
      
      <div class="card">
        <div class="pill-info-solid" id="question-explorer-info" style="background: #F0F7FB; border: 1px solid rgba(42, 95, 142, 0.2); color: var(--secondary-blue); margin-bottom: 16px; display: block;">
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
            <i class="fa-solid fa-circle-info"></i> é¡¯ç¤ºæ‰€æœ‰ 28 é¡Œçš„è©³ç´°åˆ†ä½ˆ (æœ‰æ•ˆæ¨£æœ¬æ•¸ N = <span id="grid-n">--</span>)
          </div>
          <div class="color-legend">
            <div class="legend-item"><span class="legend-dot" style="background:#2A5F8E"></span>å­¸ç¿’æ”¶ç©«</div>
            <div class="legend-item"><span class="legend-dot" style="background:#7D6586"></span>åæ€è½‰åŒ–</div>
            <div class="legend-item"><span class="legend-dot" style="background:#A65E4E"></span>è¡Œç‚ºæ„å‘</div>
            <div class="legend-item"><span class="legend-dot" style="background:#D4A017"></span>çµ„ç¹”è®Šé©</div>
            <div class="legend-item"><span class="legend-dot" style="background:#5D9C59"></span>çµ„ç¹”èªåŒ</div>
            <div class="legend-item"><span class="legend-dot" style="background:#546E7A"></span>æ•´é«”å®‰æ’</div>
            <div class="legend-item"><span class="legend-dot" style="background:#8E44AD"></span>è­°ç¨‹å…§å®¹</div>
            <div class="legend-item"><span class="legend-dot" style="background:#D35400"></span>å­¸ç¿’éœ€æ±‚</div>
            <div class="legend-item"><span class="legend-dot" style="background:#27AE60"></span>å¿ƒç†å®‰å…¨èˆ‡åˆä½œ</div>
          </div>
        </div>
        <div id="likertGrid" class="likert-grid">
          <!-- JS will populate this -->
        </div>
      </div>
    </section>

    <!-- Section 4: LHS Synthesis & Strategy -->
    <section class="section" id="lhs-synthesis">
      <div class="section-header">
        <div>
          <div class="section-title lhs-title" style="color: var(--primary);">LHS å­¸ç¿’å‹çµ„ç¹”ï¼šå¾æ•¸æ“šåˆ°å¯¦è¸çš„å„ªåŒ–å¾ªç’°</div>
          <div class="section-desc">æ•´åˆé‡åŒ–æ•¸æ“šèˆ‡è³ªæ€§å›é¥‹ï¼Œä»¥ã€Œæ•¸æ“šâ†’çŸ¥è­˜â†’å¯¦è¸ã€å¾ªç’°æ¨å‹•æŒçºŒæ”¹å–„ã€‚</div>
        </div>
      </div>

      <!-- LHS Introduction -->
      <div class="lhs-intro">
        <div class="lhs-intro-icon"><i class="fa-solid fa-infinity"></i></div>
        <div>
          <h3 style="margin:0 0 12px 0; font-size:22px; font-weight:800; color:var(--primary);">å‡èšå…±è­˜ï¼Œé©…å‹•æ•™å­¸æŒçºŒå„ªåŒ–</h3>
          <p style="margin:0; font-size:18px; color:#5C524B;">æˆ‘å€‘å°‡ LHS çš„ã€Œæ•¸æ“š-çŸ¥è­˜-å¯¦è¸ã€å¾ªç’°èå…¥é†«å­¸æ•™è‚²ï¼Œé€™ä¸åƒ…æ˜¯æŠ€è¡“å°å…¥ï¼Œæ›´æ˜¯å»ºæ§‹ä¸€å€‹å¾è‡¨åºŠå¯¦è¸ä¸­å­¸ç¿’ã€é€éæ•¸æ“šåé¥‹æŒçºŒå„ªåŒ–çš„çµ„ç¹”æ–‡åŒ–ã€‚</p>
        </div>
      </div>

      <!-- The Cycle Stack -->
      <div class="lhs-grid">
         <!-- 1. Data -->
         <div class="lhs-card" style="border-top-color: var(--secondary-blue);">
            <div class="lhs-step-title" style="color: var(--secondary-blue);">
               <i class="fa-solid fa-database"></i> 1. æ•¸æ“š Data
            </div>
            <div class="lhs-data-item">
               <span class="lhs-data-label">æœ‰æ•ˆæ¨£æœ¬æ•¸ (N)</span>
               <span class="lhs-data-val" id="lhs-n">--</span>
            </div>
            <div class="lhs-data-item">
               <span class="lhs-data-label">æ•´é«”æ»¿æ„åº¦</span>
               <span class="lhs-data-val" id="lhs-sat">--</span>
            </div>
             <div class="lhs-data-item">
               <span class="lhs-data-label">æ¨è–¦æ„é¡˜ (NPS%)</span>
               <span class="lhs-data-val" id="lhs-recommend">--</span>
            </div>
         </div>

         <!-- 2. Knowledge -->
         <div class="lhs-card" style="border-top-color: var(--warning);">
            <div class="lhs-step-title" style="color: var(--warning);">
               <i class="fa-solid fa-lightbulb"></i> 2. çŸ¥è­˜ Knowledge
            </div>
            <div class="lhs-highlight">
               <div class="lhs-highlight-label">å„ªå‹¢æ§‹é¢ (Strength)</div>
               <div class="lhs-highlight-val" style="color:var(--success);" id="lhs-max-group">--</div>
            </div>
            <div class="lhs-highlight">
               <div class="lhs-highlight-label">ç™¼å±•æ©Ÿæœƒ (Opportunity)</div>
               <div class="lhs-highlight-val" style="color:var(--warning);" id="lhs-min-group">--</div>
            </div>
             <div style="margin-top:12px;">
               <div class="lhs-highlight-label" style="margin-bottom:8px;">å­¸å“¡é—œæ³¨ç†±é»</div>
               <div id="keyword-cloud" class="keyword-cloud">
                  <!-- JS Generated -->
               </div>
            </div>
         </div>

         <!-- 3. Practice -->
         <div class="lhs-card" style="border-top-color: var(--primary);">
            <div class="lhs-step-title" style="color: var(--primary);">
               <i class="fa-solid fa-hands-holding-circle"></i> 3. å¯¦è¸ Practice
            </div>
            <div style="margin-bottom:12px; font-weight:600; color:#475569;">æ™ºèƒ½è¡Œå‹•å»ºè­° (Action Plan)ï¼š</div>
            <ul class="lhs-action-list" id="auto-action-list">
               <!-- JS Generated -->
            </ul>
         </div>
      </div>

      <!-- Continuous Improvement Footer -->
      <div class="lhs-footer">
         <div class="lhs-step-title" style="color: var(--success); margin-bottom:16px;">
            <i class="fa-solid fa-arrows-rotate"></i> æŒçºŒå„ªåŒ– Continuous Improvement
         </div>
         <p style="margin-bottom:16px; color:#475569; font-size:16px;">å‚¾è½åƒèˆ‡è€…çš„çœŸå¯¦è²éŸ³ï¼Œæ˜¯å•Ÿå‹•ä¸‹ä¸€è¼ªå„ªåŒ–å¾ªç’°çš„é—œéµç‡ƒæ–™ã€‚</p>
         
         <!-- Tabs for Feedback Categories -->
         <div class="quote-tabs">
            <button class="quote-tab active" onclick="showQuotes('takeaway')">âœ¨ æœ€æœ‰æ”¶ç©«</button>
            <button class="quote-tab" onclick="showQuotes('improvement')">ğŸ”§ å¾…æ”¹é€²</button>
            <button class="quote-tab" onclick="showQuotes('future')">ğŸŒ± æœªä¾†è¨±é¡˜</button>
         </div>
         
         <div class="quote-scroll" id="quote-list">
            <!-- JS Generated Quotes -->
         </div>
      </div>

    </section>

    <footer>
      Â© 2025 Chi Mei Medical Center. All rights reserved.
    </footer>

  </div>

  <script>
    // Define Palette
    const PALETTE = {
      'å­¸ç¿’æ”¶ç©«': { hex: '#2A5F8E', rgb: '42, 95, 142' }, 
      'åæ€è½‰åŒ–': { hex: '#7D6586', rgb: '125, 101, 134' }, 
      'è¡Œç‚ºæ„å‘': { hex: '#A65E4E', rgb: '166, 94, 78' }, 
      'çµ„ç¹”è®Šé©': { hex: '#D4A017', rgb: '212, 160, 23' }, 
      'çµ„ç¹”èªåŒ': { hex: '#5D9C59', rgb: '93, 156, 89' },
      // New Sat Colors
      'æ•´é«”å®‰æ’': { hex: '#546E7A', rgb: '84, 110, 122' }, 
      'è­°ç¨‹å…§å®¹': { hex: '#8E44AD', rgb: '142, 68, 173' }, 
      'å­¸ç¿’éœ€æ±‚': { hex: '#D35400', rgb: '211, 84, 0' }, 
      'å¿ƒç†å®‰å…¨èˆ‡åˆä½œ': { hex: '#27AE60', rgb: '39, 174, 96' },
      'æ»¿æ„åº¦':   { hex: '#0EA5E9', rgb: '14, 165, 233' } // Default fallback
    };

    const CONFIG = {
      // æ‚¨çš„ CSV é€£çµ
      csvUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTgTfRnGpcG3QWZikSNGSi70k4ipyukVO_7-FgLxqKmeQUrQuBSSxvngRJHa48OK4ZvfDPcrtz8taF4/pub?output=csv',

      questions: {
        // --- å¾Œæ¸¬ (Post) ---
        "post_1": "[å­¸ç¿’] 1. æ¸…æ¥šé†«å­¸æ•™è‚²åŒ—æ¥µæ˜Ÿèˆ‡æ–¹å‘",
        "post_2": "[å­¸ç¿’] 2. ç†è§£é†«å­¸äººæ–‡èˆ‡CBMEæ•´åˆç­–ç•¥",
        "post_3": "[å­¸ç¿’] 3. å­¸åˆ°å¯ç«‹å³é‹ç”¨çš„æ•™å­¸æŠ€å·§",
        "post_4": "[å­¸ç¿’] 4. å°åŠŸèƒ½å°çµ„å®šä½æ›´åŠ æ¸…æ™°",
        "post_5": "[åæ€] 5. é‡æ–°æ€è€ƒæ•™å­¸è§’è‰²èˆ‡å®šä½",
        "post_6": "[åæ€] 6. åæ€æ—¢æœ‰æ•™å­¸æ–¹å¼",
        "post_7": "[åæ€] 7. ç†è§£é†«æ•™åœ¨é†«é™¢æ–‡åŒ–çš„é‡è¦æ€§",
        "post_8": "[è¡Œç‚º] 8. æœ‰ä¿¡å¿ƒé‹ç”¨å…§å®¹æ–¼è‡¨åºŠæ•™å­¸",
        "post_9": "[è¡Œç‚º] 9. é¡˜æ„æ¡ç”¨æ–°æ•™å­¸æ³•æˆ–å”ä½œ",
        "post_10": "[è¡Œç‚º] 10. é¡˜æ„åƒèˆ‡é™¢ç´šæ•™å­¸è¨ˆç•«",
        "post_11": "[è®Šé©] 11. ç›¸ä¿¡åŒä»æœƒæ”¯æŒæ¨å‹•æ”¹å–„",
        "post_12": "[è®Šé©] 12. é†«é™¢å…·å‚™è‰¯å¥½æ•™å­¸æ–‡åŒ–æ°›åœ",
        "post_13": "[è®Šé©] 13. é¡˜æ„æˆç‚ºæ¨å‹•æ”¹å–„çš„ä¸€ä»½å­",
        "post_14": "[èªåŒ] 14. å°é†«é™¢ä½¿å‘½èªåŒæ›´æ·±",
        "post_15": "[èªåŒ] 15. é¡˜æ„å‘ä»–äººæ¨è–¦æœ¬æ´»å‹•",
        
        // --- æ»¿æ„åº¦ (Sat) ---
        "sat_1": "[æ»¿æ„åº¦] 1. æ´»å‹•æµç¨‹èˆ‡æ•´é«”å®‰æ’",
        "sat_2": "[æ»¿æ„åº¦] 2. è¬›è€…å…§å®¹æ·±åº¦èˆ‡å¯¦ç”¨æ€§",
        "sat_3": "[æ»¿æ„åº¦] 3. äº’å‹•æ€§èˆ‡åƒèˆ‡æ„Ÿ",
        "sat_4": "[æ»¿æ„åº¦] 4. å ´åœ°ã€æ™‚é–“èˆ‡è¡Œæ”¿å®‰æ’",
        "sat_5": "[æ»¿æ„åº¦] 5. åŒ—æ¥µæ˜Ÿèªªæ˜æ¸…æ™°åº¦",
        "sat_6": "[æ»¿æ„åº¦] 6. å¤šå…ƒéŸŒæ€§å…§å®¹å¯¦ç”¨æ€§",
        "sat_7": "[æ»¿æ„åº¦] 7. æ•™å­¸ä¸»æ²»åˆ†äº«åƒ¹å€¼",
        "sat_8": "[æ»¿æ„åº¦] 8. æ•´åˆè³‡è¨Šè±å¯Œæ€§",
        "sat_9": "[æ»¿æ„åº¦] 9. åˆ†çµ„è¨è«–å¯¦ç”¨æ€§",
        "sat_10": "[æ»¿æ„åº¦] 10. ç¬¦åˆè‡¨åºŠ/æ•™å­¸éœ€æ±‚",
        "sat_11": "[æ»¿æ„åº¦] 11. é¼“å‹µç¶“é©—äº¤æµ",
        "sat_12": "[æ»¿æ„åº¦] 12. ä¿ƒé€²è·¨éƒ¨é–€é€£çµ",
        "sat_13": "[æ»¿æ„åº¦] 13. å¿ƒç†å®‰å…¨èˆ‡é–‹æ”¾ç©ºé–“"
      },

      // Updated to include future explicitly
      textCols: {
        takeaway: ['open_sat_1'],
        improvement: ['open_sat_2'], // Only improvement
        future: ['open_sat_3']         // Future only
      },

      keywordRules: [
        { key: 'æ™‚é–“', label: 'æ™‚é–“æŒæ§', tags: ['æ™‚é–“','å¤ªè¶•','è¶…æ™‚','ç·Šæ¹Š','åŒ†ä¿ƒ'], suggestion: 'å„ªåŒ–è­°ç¨‹æ™‚é–“åˆ†é…ï¼Œæˆ–å¢åŠ ä¸­å ´ä¼‘æ¯ç·©è¡ã€‚' },
        { key: 'å†·æ°£', label: 'ç’°å¢ƒç©ºèª¿', tags: ['å†·æ°£','å¤ªå†·','å¤ªç†±','ç©ºèª¿','æ‚¶'], suggestion: 'èˆ‡å ´åœ°ç®¡ç†å–®ä½ç¢ºèªç©ºèª¿è¨­å®šã€‚' },
        { key: 'äº’å‹•', label: 'äº’å‹•äº¤æµ', tags: ['äº’å‹•','å°‘','äº¤æµ','è¨è«–','å–®å‘'], suggestion: 'å¢åŠ åˆ†çµ„è¨è«–æˆ– Q&A æ™‚é–“ï¼Œæå‡åƒèˆ‡æ„Ÿã€‚' },
        { key: 'é¤é»', label: 'é¤é»èŒ¶æ°´', tags: ['é¤é»','ä¾¿ç•¶','åƒ','æ°´','èŒ¶'], suggestion: 'æª¢è¦–é¤é»æ»¿æ„åº¦æˆ–å¤šæ¨£æ€§ã€‚' },
        { key: 'å¯¦ç”¨', label: 'å…§å®¹å¯¦ç”¨æ€§', tags: ['ç†è«–','å¤ªæ·±','é›£æ‡‚','æ‡‰ç”¨','å¯¦ä½œ'], suggestion: 'å¢åŠ è‡¨åºŠå¯¦ä¾‹æˆ–å¯¦ä½œæ¼”ç·´ï¼Œé™ä½ç†è«–æ¯”é‡ã€‚' },
        { key: 'å ´åœ°', label: 'å ´åœ°è¨­å‚™', tags: ['è¢å¹•','éº¥å…‹é¢¨','çœ‹ä¸åˆ°','å¤ªå°','æ“ '], suggestion: 'å„ªåŒ–åº§ä½å®‰æ’æˆ–æª¢æŸ¥è¦–è½è¨­å‚™ã€‚' }
      ],

      coreGroups: [
        { label: 'å­¸ç¿’æ”¶ç©«', cols: ['post_1','post_2','post_3','post_4'] },
        { label: 'åæ€è½‰åŒ–', cols: ['post_5','post_6','post_7'] },
        { label: 'è¡Œç‚ºæ„å‘', cols: ['post_8','post_9','post_10'] },
        { label: 'çµ„ç¹”è®Šé©', cols: ['post_11','post_12','post_13'] },
        { label: 'çµ„ç¹”èªåŒ', cols: ['post_14','post_15'] }
      ],

      satisfactionGroups: [
        { label: 'æ•´é«”å®‰æ’', cols: ['sat_1','sat_2', 'sat_3', 'sat_4'] },
        { label: 'è­°ç¨‹å…§å®¹', cols: ['sat_5','sat_6','sat_7','sat_8', 'sat_9'] },
        { label: 'å­¸ç¿’éœ€æ±‚', cols: ['sat_10','sat_11'] }, 
        { label: 'å¿ƒç†å®‰å…¨èˆ‡åˆä½œ', cols: ['sat_12','sat_13'] }
      ],

      suggestions: {
        'å­¸ç¿’æ”¶ç©«': 'åŠ å¼·èª²ç¨‹å…§å®¹çš„å¯¦ç”¨æ€§ï¼Œæˆ–å¢åŠ é€²éšå·¥ä½œåŠï¼Œè®“å­¸å“¡èƒ½å¸¶èµ°æ›´å¤šå…·é«”æŠ€å·§ã€‚',
        'åæ€è½‰åŒ–': 'åœ¨æ´»å‹•ä¸­å¢åŠ ã€Œå¼•å°åæ€ (Debriefing)ã€ç’°ç¯€ï¼Œå”åŠ©å­¸å“¡å°‡çŸ¥è­˜å…§åŒ–ç‚ºå€‹äººè§€é»ã€‚',
        'è¡Œç‚ºæ„å‘': 'å»ºç«‹èª²å¾Œå¯¦è¸ç¤¾ç¾¤æˆ–è¿½è¹¤æ©Ÿåˆ¶ï¼Œæä¾›å¾®å‹æ•™å­¸å·¥å…·ï¼Œé™ä½å­¸å“¡å›åˆ°è‡¨åºŠå¾Œçš„æ‡‰ç”¨é–€æª»ã€‚',
        'çµ„ç¹”è®Šé©': 'é«˜å±¤æŒçºŒå…¬é–‹æ”¯æŒï¼Œä¸¦ç‡Ÿé€ å¿ƒç†å®‰å…¨æ„Ÿï¼Œè®“å­¸å“¡ç›¸ä¿¡æ”¹è®Šæ˜¯å—æ­¡è¿ä¸”å®‰å…¨çš„ã€‚',
        'çµ„ç¹”èªåŒ': 'å¤šåˆ†äº«å…§éƒ¨çš„æˆåŠŸæ•…äº‹èˆ‡å…¸ç¯„æ¡ˆä¾‹ï¼Œå¼·åŒ–æ¦®è­½æ„Ÿï¼Œè®“å­¸å“¡ä»¥èº«ç‚ºåœ˜éšŠä¸€å“¡ç‚ºæ¦®ã€‚'
      }
    };

    let rawData = [];
    let likertStats = {}; 
    let parsedTexts = {
      takeaway: [],
      improvement: [],
      future: []
    };

    // Helper functions defined at root
    function getCategoryColor(key) {
      for (const g of CONFIG.coreGroups) {
        if (g.cols.includes(key)) return PALETTE[g.label] || PALETTE['æ»¿æ„åº¦'];
      }
      for (const g of CONFIG.satisfactionGroups) {
        if (g.cols.includes(key)) return PALETTE[g.label] || PALETTE['æ»¿æ„åº¦'];
      }
      return PALETTE['æ»¿æ„åº¦'];
    }

    function getCategoryColorForGroup(groupLabel) {
       return PALETTE[groupLabel] || PALETTE['æ»¿æ„åº¦'];
    }

    function getQuestionGroupLabel(key) {
      for (const g of CONFIG.coreGroups) { if (g.cols.includes(key)) return g.label; }
      for (const g of CONFIG.satisfactionGroups) { if (g.cols.includes(key)) return g.label; }
      return "å…¶ä»–";
    }

    function calculateOneSampleTTest(values, testValue) {
      const n = values.length;
      if(n < 2) return { t: 0, p: 1, mean: values[0] || 0, sd: 0 };
      const mean = values.reduce((a,b)=>a+b,0) / n;
      const variance = values.reduce((a,b)=>a + Math.pow(b-mean, 2), 0) / (n-1);
      const sd = Math.sqrt(variance);
      const se = sd / Math.sqrt(n);
      const t = (mean - testValue) / se;
      const p = standardNormalRightTailProbability(t);
      return { t, p, mean, sd, n };
    }

    function standardNormalRightTailProbability(z) {
      if (z < 0) z = -z; 
      const p = 0.2316419;
      const b1 = 0.319381530;
      const b2 = -0.356563782;
      const b3 = 1.781477937;
      const b4 = -1.821255978;
      const b5 = 1.330274429;
      const t = 1 / (1 + p * z);
      const Z = (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-z * z / 2);
      return Z * (b1 * t + b2 * t * t + b3 * t * t * t + b4 * t * t * t * t + b5 * t * t * t * t * t);
    }

    function init() {
      Papa.parse(CONFIG.csvUrl, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          rawData = results.data;
          processData();
          renderDashboard();
          analyzeQualitativeData();
          document.getElementById('loading-overlay').style.opacity = 0;
          setTimeout(() => document.getElementById('loading-overlay').style.display = 'none', 500);
        },
        error: function(err) {
          alert("CSV è®€å–å¤±æ•—: " + err.message);
        }
      });
    }

    function processData() {
      Object.keys(CONFIG.questions).forEach(key => {
        let sum = 0;
        let count = 0;
        let dist = {1:0, 2:0, 3:0, 4:0, 5:0};
        rawData.forEach(row => {
          let val = parseFloat(row[key]);
          if (!isNaN(val) && val >= 1 && val <= 5) {
            sum += val;
            count++;
            let vInt = Math.round(val);
            if(dist[vInt] !== undefined) dist[vInt]++;
          }
        });
        likertStats[key] = {
          label: CONFIG.questions[key],
          mean: count > 0 ? (sum / count) : 0,
          n: count,
          dist: [dist[1], dist[2], dist[3], dist[4], dist[5]]
        };
      });
    }

    function getRowGroupScore(row, cols) {
      let sum = 0, count = 0;
      cols.forEach(c => {
        let v = parseFloat(row[c]);
        if(!isNaN(v)) { sum += v; count++; }
      });
      return count === 0 ? null : sum / count;
    }

    function analyzeQualitativeData() {
      // Initialize
      parsedTexts = { takeaway: [], improvement: [], future: [] };
      const keywordsCount = {};
      const suggestions = []; 
      
      const collectText = (cols, targetArray) => {
        if (!cols || !Array.isArray(cols)) return;
        cols.forEach(col => {
           rawData.forEach(row => {
             if (row[col] && row[col].trim().length > 1) {
               targetArray.push(row[col].trim());
             }
           });
        });
      };

      collectText(CONFIG.textCols.takeaway, parsedTexts.takeaway);
      collectText(CONFIG.textCols.improvement, parsedTexts.improvement);
      collectText(CONFIG.textCols.future, parsedTexts.future); 

      // Keyword Matching only on Improvement texts
      CONFIG.keywordRules.forEach(rule => {
        let count = 0;
        parsedTexts.improvement.forEach(text => {
          if (rule.tags.some(tag => text.includes(tag))) {
            count++;
          }
        });
        if (count > 0) {
          keywordsCount[rule.key] = count;
          suggestions.push(rule); 
        }
      });

      const cloudContainer = document.getElementById('keyword-cloud');
      
      if (cloudContainer) {
        cloudContainer.innerHTML = '';
        if (Object.keys(keywordsCount).length === 0) {
          cloudContainer.innerHTML = '<span class="keyword-tag">æš«ç„¡é¡¯è‘—é—œéµå­—</span>';
        } else {
          Object.entries(keywordsCount)
            .sort((a,b) => b[1] - a[1]) 
            .forEach(([key, count]) => {
              const rule = CONFIG.keywordRules.find(r => r.key === key);
              const isHot = count >= 3; 
              const tag = document.createElement('span');
              tag.className = `keyword-tag ${isHot ? 'hot' : ''}`;
              tag.innerText = `${rule.label} (${count})`;
              cloudContainer.appendChild(tag);
            });
        }
      }

      // Initial render of quotes
      showQuotes('takeaway');

      return { suggestions, keywordsCount }; 
    }

    window.showQuotes = function(type) {
      const quoteList = document.getElementById('quote-list');
      if (!quoteList) return;
      
      document.querySelectorAll('.quote-tab').forEach(btn => {
         btn.classList.remove('active');
         if(btn.onclick.toString().includes(type)) btn.classList.add('active');
      });

      quoteList.innerHTML = '';
      const texts = parsedTexts[type] || [];
      
      if (texts.length === 0) {
        quoteList.innerHTML = '<div class="quote-item">ç„¡ç›¸é—œå›é¥‹è³‡æ–™</div>';
      } else {
        const displayTexts = texts.slice(0, 20); 
        displayTexts.forEach(q => {
          const div = document.createElement('div');
          div.className = 'quote-item';
          div.innerText = q; 
          quoteList.appendChild(div);
        });
      }
    };

    function renderDashboard() {
      const N = rawData.length;
      document.getElementById('hero-n').innerText = N;
      document.getElementById('stat-n').innerText = N;
      document.getElementById('grid-n').innerText = N;
      
      // Update LHS Data Col explicitly
      const lhsN = document.getElementById('lhs-n');
      if(lhsN) lhsN.innerText = N;

      let satSum = 0, satCount = 0;
      Object.keys(CONFIG.questions).forEach(k => {
        if(k.startsWith('sat_') && likertStats[k].n > 0) {
          satSum += likertStats[k].mean;
          satCount++;
        }
      });
      const avgSat = satCount > 0 ? (satSum/satCount).toFixed(2) : '-';
      document.getElementById('stat-sat').innerText = avgSat;
      
      // Update LHS Sat
      const lhsSat = document.getElementById('lhs-sat');
      if(lhsSat) lhsSat.innerText = avgSat;

      let recPct = 0;
      if(likertStats['post_15']) {
        const p15 = likertStats['post_15'];
        const positive = p15.dist[3] + p15.dist[4]; 
        recPct = p15.n > 0 ? Math.round((positive / p15.n) * 100) : 0;
        document.getElementById('stat-recommend').innerText = recPct;
        
        // Update LHS Recommend
        const lhsRec = document.getElementById('lhs-recommend');
        if(lhsRec) lhsRec.innerText = recPct + '%';
      }

      let coreStats = [];
      CONFIG.coreGroups.forEach(g => {
        let scores = [];
        rawData.forEach(r => {
          let s = getRowGroupScore(r, g.cols);
          if(s !== null) scores.push(s);
        });
        const stats = calculateOneSampleTTest(scores, 3.0);
        coreStats.push({ label: g.label, ...stats });
      });

      let satStats = [];
      CONFIG.satisfactionGroups.forEach(g => {
        let scores = [];
        rawData.forEach(r => {
          let s = getRowGroupScore(r, g.cols);
          if(s !== null) scores.push(s);
        });
        const stats = calculateOneSampleTTest(scores, 3.0);
        satStats.push({ label: g.label, ...stats });
      });

      generateStatNarrative(coreStats, 'stat-narrative-content', 'å­¸ç¿’æˆæ•ˆ');
      generateStatNarrative(satStats, 'sat-narrative-content', 'æ´»å‹•æ»¿æ„åº¦');

      const sortedCore = [...coreStats].sort((a, b) => b.mean - a.mean);
      const best = sortedCore[0];
      const worst = sortedCore[sortedCore.length - 1];

      document.getElementById('stat-best').innerText = best.label;
      
      // Update LHS Knowledge
      const lhsMax = document.getElementById('lhs-max-group');
      if(lhsMax) lhsMax.innerText = best.label;
      
      const lhsMin = document.getElementById('lhs-min-group');
      if(lhsMin) lhsMin.innerText = worst.label;
      
      // Update LHS Practice
      const actionList = document.getElementById('auto-action-list');
      if (actionList) {
        actionList.innerHTML = '';

        const quantSuggestion = CONFIG.suggestions[worst.label] || 'å»ºè­°æ·±å…¥è¨ªè«‡å­¸å“¡ï¼Œäº†è§£åˆ†æ•¸è¼ƒä½çš„åŸå› ã€‚';
        const quantItem = document.createElement('li');
        quantItem.className = 'lhs-action-item';
        quantItem.innerHTML = `
          <div class="lhs-action-icon"><i class="fa-solid fa-chart-bar"></i></div>
          <div class="lhs-action-text">
            <strong>é‡å°ã€Œ${worst.label}ã€</strong><br>${quantSuggestion}
          </div>
        `;
        actionList.appendChild(quantItem);

        const qualData = analyzeQualitativeData();
        const qualSuggestions = qualData.suggestions;
        
        if (qualSuggestions.length > 0) {
          qualSuggestions.slice(0, 2).forEach(s => {
            const item = document.createElement('li');
            item.className = 'lhs-action-item';
            item.innerHTML = `
              <div class="lhs-action-icon" style="background:#DC2626; color:white;"><i class="fa-solid fa-comment-dots"></i></div>
              <div class="lhs-action-text">
                <strong style="color:#DC2626;">å„ªåŒ–ã€Œ${s.label}ã€</strong><br>${s.suggestion}
              </div>
            `;
            actionList.appendChild(item);
          });
        } else {
           const item = document.createElement('li');
            item.className = 'lhs-action-item';
            item.innerHTML = `
              <div class="lhs-action-icon" style="background:#9CA3AF; color:white;"><i class="fa-solid fa-check"></i></div>
              <div class="lhs-action-text">
                <strong>è³ªæ€§å›é¥‹è‰¯å¥½</strong><br>ç›®å‰æœªåµæ¸¬åˆ°é¡¯è‘—çš„è² é¢é—œéµå­—ã€‚
              </div>
            `;
            actionList.appendChild(item);
        }
      }
      
      // Update Summary Charts with distinct colors
      const coreColors = coreStats.map(s => getCategoryColorForGroup(s.label).hex);
      renderChart('effectivenessChart', coreStats, coreColors, 'å­¸ç¿’æˆæ•ˆ'); 
      
      const satColors = satStats.map(s => getCategoryColorForGroup(s.label).hex);
      renderChart('satisfactionChart', satStats, satColors, 'æ»¿æ„åº¦');   
      
      initLikertGrid();
      
      const infoBar = document.getElementById('question-explorer-info');
      if (infoBar) {
        infoBar.innerHTML = `
          <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
            <i class="fa-solid fa-circle-info"></i> é¡¯ç¤ºæ‰€æœ‰ 28 é¡Œçš„è©³ç´°åˆ†ä½ˆ (æœ‰æ•ˆæ¨£æœ¬æ•¸ N = <span id="grid-n">${N}</span>)
          </div>
          <div class="color-legend">
            <div class="legend-item"><span class="legend-dot" style="background:#2A5F8E"></span>å­¸ç¿’æ”¶ç©«</div>
            <div class="legend-item"><span class="legend-dot" style="background:#7D6586"></span>åæ€è½‰åŒ–</div>
            <div class="legend-item"><span class="legend-dot" style="background:#A65E4E"></span>è¡Œç‚ºæ„å‘</div>
            <div class="legend-item"><span class="legend-dot" style="background:#D4A017"></span>çµ„ç¹”è®Šé©</div>
            <div class="legend-item"><span class="legend-dot" style="background:#5D9C59"></span>çµ„ç¹”èªåŒ</div>
            <div class="legend-item"><span class="legend-dot" style="background:#546E7A"></span>æ•´é«”å®‰æ’</div>
            <div class="legend-item"><span class="legend-dot" style="background:#8E44AD"></span>è­°ç¨‹å…§å®¹</div>
            <div class="legend-item"><span class="legend-dot" style="background:#D35400"></span>å­¸ç¿’éœ€æ±‚</div>
            <div class="legend-item"><span class="legend-dot" style="background:#27AE60"></span>å¿ƒç†å®‰å…¨èˆ‡åˆä½œ</div>
          </div>
        `;
      }
    }

    // Simplified Narrative
    function generateStatNarrative(stats, containerId, typeName) {
      let allSig = stats.every(g => g.p < 0.05);
      const sorted = [...stats].sort((a,b) => b.mean - a.mean);
      const best = sorted[0];
      const minSd = Math.min(...stats.map(g=>g.sd)).toFixed(2);
      const maxSd = Math.max(...stats.map(g=>g.sd)).toFixed(2);
      const minMean = sorted[sorted.length-1].mean.toFixed(2);
      const maxMean = best.mean.toFixed(2);

      const container = document.getElementById(containerId);

      let html = `
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <div class="best-perf-box">
            <i class="fa-solid fa-trophy"></i> è¡¨ç¾æœ€ä½³ï¼š${best.label}
            <span style="color: #6B635F; margin-left: auto; font-weight:500; font-size:16px;">(Mean ${best.mean.toFixed(2)})</span>
          </div>
          <div class="stat-insight-grid">
            <div class="stat-insight-item">
              <div class="stat-insight-label">æˆæ•ˆé©—è­‰</div>
              <div class="stat-insight-content" style="color: ${allSig ? 'var(--success)' : '#6B635F'}">
                ${allSig ? '<i class="fa-solid fa-circle-check"></i> çš†é¡¯è‘—æ­£å‘' : 'éƒ¨åˆ†é¡¯è‘—'}
              </div>
              <div class="stat-insight-sub">P-value < .001 (vs 3.0)</div>
            </div>
            <div class="stat-insight-item">
              <div class="stat-insight-label">æ„è¦‹ä¸€è‡´æ€§</div>
              <div class="stat-insight-content">é«˜åº¦é›†ä¸­</div>
              <div class="stat-insight-sub">SD: ${minSd}~${maxSd}</div>
            </div>
            <div class="stat-insight-item">
              <div class="stat-insight-label">å¹³å‡åˆ†ä½ˆ</div>
              <div class="stat-insight-content">${minMean} ~ ${maxMean}</div>
              <div class="stat-insight-sub">æ»¿åˆ† 5.0</div>
            </div>
          </div>
        </div>
      `;
      container.innerHTML = html;
    }

    function renderChart(canvasId, stats, colors, labelName) {
      const labels = stats.map(s => s.label);
      const data = stats.map(s => s.mean.toFixed(2));
      const fullStats = stats; 
      
      const ctx = document.getElementById(canvasId).getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: `${labelName} (Mean)`,
            data: data,
            backgroundColor: colors, 
            borderRadius: 4,
            barPercentage: 0.5,
            categoryPercentage: 0.7,
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true, max: 5, grid: { color: 'rgba(74, 64, 58, 0.08)' }, ticks: { color: '#8C8279', font: { family: "'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif", size: 14 } } },
            x: { grid: { display: false }, ticks: { color: '#4A403A', font: { size: 16, family: "'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif", weight: 600 } } }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: (ctx) => ` â€¢ å¹³å‡ (Mean): ${ctx.formattedValue}`,
                afterBody: (tooltipItems) => {
                  const idx = tooltipItems[0].dataIndex;
                  const item = fullStats[idx];
                  const sigText = item.p < 0.05 ? "é¡¯è‘— (Sig.)" : "ä¸é¡¯è‘— (Not Sig.)";
                  const pText = item.p < 0.001 ? "< .001" : item.p.toFixed(3);
                  return [`â€¢ æ¨™æº–å·® (SD): ${item.sd.toFixed(2)}`, `â€¢ æª¢å®šçµæœ: ${sigText}`, `â€¢ P-value: ${pText}`];
                }
              },
              backgroundColor: 'rgba(255, 255, 255, 0.95)',
              titleColor: '#4A403A', // Default dark color since background colors vary
              bodyColor: '#4A403A',
              borderColor: '#E0D8D0',
              borderWidth: 1,
              padding: 16,
              titleFont: { size: 18, weight: 'bold', family: "'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif" },
              bodyFont: { size: 16, lineHeight: 1.6, family: "'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif" },
              displayColors: false,
              boxShadow: '0 6px 16px rgba(0,0,0,0.15)'
            }
          }
        }
      });
    }

    function initLikertGrid() {
      const grid = document.getElementById('likertGrid');
      grid.innerHTML = '';
      Object.entries(likertStats).forEach(([key, stats]) => {
        const card = document.createElement('div');
        card.className = 'likert-card';
        
        const colorConfig = getCategoryColor(key);
        const rgb = colorConfig.rgb;
        const hex = colorConfig.hex;

        const titleDiv = document.createElement('div');
        titleDiv.className = 'likert-title';
        titleDiv.textContent = stats.label;
        const subtitleDiv = document.createElement('div');
        subtitleDiv.className = 'likert-subtitle';
        
        // Apply color to pill
        subtitleDiv.innerHTML = `<span class="question-group-pill" style="background: rgba(${rgb}, 0.1); color: ${hex};">${getQuestionGroupLabel(key)}</span><span class="pill-info-solid">å¹³å‡ ${stats.mean.toFixed(2)} / 5</span>`;
        
        const chartDiv = document.createElement('div');
        chartDiv.className = 'mini-chart-container';
        const canvas = document.createElement('canvas');
        chartDiv.appendChild(canvas);
        card.appendChild(titleDiv);
        card.appendChild(subtitleDiv);
        card.appendChild(chartDiv);
        grid.appendChild(card);
        
        new Chart(canvas.getContext('2d'), {
          type: 'bar',
          data: {
            labels: ['1åˆ†', '2åˆ†', '3åˆ†', '4åˆ†', '5åˆ†'],
            datasets: [{
              data: stats.dist,
              // Gradient opacity using the specific color for this category
              backgroundColor: [`rgba(${rgb}, 0.2)`, `rgba(${rgb}, 0.4)`, `rgba(${rgb}, 0.6)`, `rgba(${rgb}, 0.8)`, `rgba(${rgb}, 1.0)`],
              borderRadius: 6, borderWidth: 0
            }]
          },
          options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false }, tooltip: { callbacks: { label: (ctx) => ` ${ctx.formattedValue} äºº` }, backgroundColor: '#fff', titleColor: hex, bodyColor: '#4A403A', borderColor: '#E0D8D0', borderWidth: 1, padding: 16, titleFont: { family: "'Microsoft JhengHei', sans-serif" }, bodyFont: { family: "'Microsoft JhengHei', sans-serif" } } },
            scales: { y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' }, ticks: { color: '#8C8279', precision: 0 } }, x: { grid: { display: false }, ticks: { color: '#4A403A' } } }
          }
        });
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
