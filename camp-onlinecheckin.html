<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã€Œå‰µé€ 360Â°äººç”Ÿã€ é†«å­¸æ•™è‚²å…±è­˜ç‡Ÿ å ±åˆ°ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* v15 FINAL THEME: 
       - Founder's Painting Background
       - 85% Opacity Warm Beige Card
       - Refined Success Message Layout (Flex Wrap for Mobile)
       - All buttons included (Agenda, Handouts, Survey, Group Data)
    */
    body {
      /* !!! è«‹å‹™å¿…å°‡æ­¤ç¶²å€æ›¿æ›ç‚ºæ‚¨çš„åœ–ç‰‡ç¶²å€ !!! */
      background-image: url('https://i.imgur.com/your_image_hash.jpg'); 
      background-size: cover; 
      background-position: center; 
      background-attachment: fixed; 
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      font-family: 'Noto Sans TC', sans-serif; 
      color: #333; 
    }

    .glass-card {
      background-color: rgba(248, 247, 245, 0.85); 
      border: 1px solid rgba(255, 255, 255, 0.3); 
      border-radius: 1.5rem; 
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1), 0 5px 10px rgba(0, 0, 0, 0.05); 
      max-width: 28rem; 
      width: 100%;
      margin: 1rem; 
    }

    .input-field {
      background-color: #F3F4F6; 
      border: 1px solid #D1D5DB; 
      color: #1F2937; 
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
    }
    .input-field:focus {
      border-color: #2563EB; outline: none;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    .submit-button, .reset-button {
      background-color: #2563EB; border: 1px solid #2563EB;
      color: #FFFFFF; font-weight: bold;
      padding: 0.75rem 1.5rem; border-radius: 0.5rem;
      transition: all 0.3s ease; cursor: pointer;
    }
    .submit-button:hover, .reset-button:hover {
      background-color: #1D4ED8; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .agenda-button {
      background-color: #FFFFFF; color: #374151;
      border: 1px solid #D1D5DB; display: block; 
      text-decoration: none; font-weight: 500;
    }
    .agenda-button:hover { background-color: #F9FAFB; }

    .spinner {
      display: inline-block; width: 2rem; height: 2rem; vertical-align: text-bottom;
      border: 4px solid rgba(0, 0, 0, 0.1); border-left-color: #2563EB;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .text-success { color: #1D4ED8; } 
    .text-error { color: #D97706; }   
    
    .reminder-box {
      background-color: #FFFBEB; border: 1px solid #FDE68A;
      color: #92400E; border-radius: 0.5rem;
      padding: 0.75rem 1rem; text-align: left; line-height: 1.6;
    }

    /* è³‡è¨Šå¡æ¨£å¼ */
    .info-box {
      background-color: #FFFFFF; 
      border: 1px solid #E5E7EB; 
      border-radius: 1rem;       
      padding: 1.5rem;           
      margin-top: 1.5rem;
      text-align: left; 
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    }
    .info-list-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 0.5rem;
      line-height: 1.6;
      color: #4B5563; 
    }
    .info-section-title {
      color: #111827; 
      font-weight: 700; 
      font-size: 1.125rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
    }
    .group-info-inner {
      background-color: #F3F4F6; 
      border-radius: 0.5rem;
      padding: 1rem;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100">
  
  <div class="glass-card p-8 md:p-12 text-center">
    
    <!-- æ¨™é¡Œå€ -->
    <div class="mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4 leading-tight">
        ã€Œå‰µé€ 360Â°äººç”Ÿã€<br>é†«å­¸æ•™è‚²å…±è­˜ç‡Ÿ<br>å ±åˆ°ç³»çµ±
      </h1>
      <p class="text-lg md:text-xl text-gray-600 mt-4">
        2025/11/23ï¼ˆæ—¥ï¼‰12:45â€“17:10
      </p>
      <p class="text-lg md:text-xl text-gray-600 mt-1">
        å¥‡ç¾åšç‰©é¤¨ è±æ”¶å»³
      </p>
    </div>

    <!-- å ±åˆ°è¡¨å–® -->
    <div id="checkInForm">
      <label for="employeeId" class="block text-lg font-medium text-gray-700 mb-2">
        è«‹è¼¸å…¥æ‚¨çš„äººäº‹è™Ÿ
      </label>
      <input type="text" id="employeeId" name="employeeId" 
             class="w-full input-field text-xl text-center" 
             placeholder="ç¯„ä¾‹ï¼šA12345">
      
      <button id="submitButton" 
              onclick="handleCheckIn()"
              class="w-full submit-button text-xl mt-6">
        é€å‡ºå ±åˆ°
      </button>
    </div>

    <!-- è¼‰å…¥ä¸­ç•«é¢ -->
    <div id="loadingIndicator" class="hidden text-center py-8">
      <div class="spinner mx-auto"></div>
      <p class="text-lg text-gray-600 mt-4">å ±åˆ°ä¸­ï¼Œè«‹ç¨å€™...</p>
    </div>

    <!-- çµæœè¨Šæ¯ -->
    <div id="resultMessage" class="hidden mt-6 text-center">
      <!-- å ±åˆ°ç‹€æ…‹æ¨™é¡Œ -->
      <p id="messageText" class="text-2xl font-semibold whitespace-pre-line mb-2"></p>
      
      <!-- è©³ç´°æ´»å‹•èˆ‡åˆ†çµ„è³‡è¨Šå€å¡Š (ç™½è‰²å¡ç‰‡) -->
      <div id="successInfoBox" class="hidden info-box">
        
        <!-- 1. æ´»å‹•å®‰æ’æé†’ -->
        <div class="mb-6">
          <h3 class="info-section-title text-red-700"> 
            ğŸ“Œ ä»Šæ—¥æ´»å‹•æé†’
          </h3>
          <div class="text-base pl-1">
            <div class="info-list-item">
              <span class="mr-2 text-gray-400">â—</span><span>é è¨ˆæ–¼ã€Œè±æ”¶å»³ã€å…±åŒä¸Šèª²ï¼Œå¦‚æœ‰ç•°å‹•è«‹ä¾ç¾å ´æŒ‡ç¤ºã€‚</span>
            </div>
            <div class="info-list-item">
              <span class="mr-2 text-gray-400">â—</span><span>åƒ… 15:50â€“16:30 ç‚ºåˆ†çµ„è¨è«–ï¼Œè«‹ä¾çµ„åˆ¥å‰å¾€åˆ†çµ„åœ°é»</span>
            </div>
          </div>
        </div>
        
        <hr class="border-gray-200 my-4">

        <!-- 2. åˆ†çµ„è³‡è¨Š -->
        <div>
          <h3 class="info-section-title text-blue-800">
            ğŸ“ åˆ†çµ„è³‡è¨Š
          </h3>
          <div class="group-info-inner space-y-3">
            <p class="text-lg flex flex-wrap items-baseline gap-2">
              <span class="text-gray-500 text-base whitespace-nowrap">æ‚¨çš„çµ„åˆ¥ï¼š</span>
              <span id="displayGroup" class="font-bold text-gray-900 text-xl"></span>
            </p>
            <p class="text-lg flex flex-wrap items-baseline gap-2">
              <span class="text-gray-500 text-base whitespace-nowrap">åˆ†çµ„åœ°é»ï¼š</span>
              <span id="displayLocation" class="font-bold text-blue-600 text-xl"></span>
            </p>
          </div>
        </div>
      </div>
      
      <!-- èˆŠçš„é¡¯ç¤ºå€å¡Š (åƒ…ç”¨æ–¼é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯æ™‚çš„çµ„åˆ¥ï¼Œå¹³æ™‚éš±è—) -->
      <div id="errorInfo" class="hidden">
        <p id="groupText" class="text-xl text-gray-700 mt-2"></p>
        <p id="locationText" class="text-xl text-gray-700 mt-1"></p>
      </div>

      <!-- æé†’æ–‡å­— (é»ƒè‰²å€å¡Š - ä¿æŒç¨ç«‹) -->
      <p id="reminderText" class="hidden text-base mt-8 reminder-box">
        <strong>é‡è¦æé†’ï¼š</strong><br>
        è«‹ä¿ç•™æ­¤é é¢ï¼è­°ç¨‹ã€åˆ†çµ„å…±è­˜è³‡æ–™å¡«å¯«åŠæ»¿æ„åº¦èª¿æŸ¥å°‡æœƒé¡¯ç¤ºæ–¼æ­¤ã€‚
      </p>

      <!-- æŒ‰éˆ•ç¾¤çµ„ -->
      <div id="actionButtons" class="hidden mt-6 space-y-3">
        <a href="https://ling3567.github.io/ChiMeiMonth1123/camp?v=2" 
           target="_blank" class="w-full reset-button agenda-button text-lg py-3">
          æŸ¥çœ‹å…±è­˜ç‡Ÿè­°ç¨‹
        </a>

        <!-- (!!! NEW: æ–°å¢è¬›ç¾©æŒ‰éˆ• !!!) -->
        <a id="handoutLink" 
           href="https://drive.google.com/drive/folders/1Gykwz7lIRyVJS-Nsf-HZ6NBN2S5lMuFB?usp=drive_link" 
           target="_blank"
           class="hidden w-full reset-button agenda-button text-lg py-3">
          æŸ¥çœ‹å…±è­˜ç‡Ÿç›¸é—œè¬›ç¾©
        </a>
        <!-- (!!! END NEW !!!) -->
        
        <a href="https://ling3567.github.io/ChiMeiMonth1123/camp-planning.html" 
           target="_blank" class="w-full reset-button agenda-button text-lg py-3">
          åˆ†çµ„å…±è­˜è³‡æ–™å¡«å¯«
        </a>
        
        <a href="https://luyun1224.github.io/Teaching-Consensus-Camp-Questionnaire" 
           target="_blank" id="surveyLink" class="w-full reset-button agenda-button text-lg py-3">
          æ»¿æ„åº¦å•å·å¡«å¯«
        </a>
      </div>
      
      <!-- è¿”å›æŒ‰éˆ• -->
      <button onclick="resetForm()" 
              class="w-full reset-button text-lg mt-8">
        è¿”å›å ±åˆ°é¦–é 
      </button>
    </div>

  </div>

  <script>
    // -----------------------------------------------------------------
    // !!! é—œéµè¨­å®šï¼šè«‹ç¢ºèªæ­¤è™•ç‚ºæ‚¨éƒ¨ç½²å¾Œçš„ Web App URL !!!
    // -----------------------------------------------------------------
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbweDq70D9T01XvspyieBBLVFmXOY3WsP0ZaWR0k68XM5IRtgmKmtODfoT43h0JCMrIbwg/exec";
    // -----------------------------------------------------------------

    const form = document.getElementById('checkInForm');
    const loading = document.getElementById('loadingIndicator');
    const resultDiv = document.getElementById('resultMessage');
    const messageText = document.getElementById('messageText');
    
    const successInfoBox = document.getElementById('successInfoBox');
    const displayGroup = document.getElementById('displayGroup');
    const displayLocation = document.getElementById('displayLocation');
    
    const errorInfo = document.getElementById('errorInfo');
    const groupText = document.getElementById('groupText');
    const locationText = document.getElementById('locationText');
    
    const reminderText = document.getElementById('reminderText');
    const actionButtons = document.getElementById('actionButtons');
    const input = document.getElementById('employeeId');

    // (!!! NEW: å–å¾—è¬›ç¾©æŒ‰éˆ• !!!)
    const handoutLink = document.getElementById('handoutLink'); 

    async function handleCheckIn() {
      const employeeId = input.value;
      if (!employeeId) {
        alert("è«‹è¼¸å…¥äººäº‹è™Ÿï¼"); 
        return;
      }

      form.classList.add('hidden');
      loading.classList.remove('hidden');
      resultDiv.classList.add('hidden');

      try {
        const response = await fetch(WEB_APP_URL, {
          method: 'POST', mode: 'cors',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({ action: "processCheckIn", employeeId: employeeId })
        });

        if (!response.ok) throw new Error(`HTTP éŒ¯èª¤! ç‹€æ…‹: ${response.status}`);
        const result = await response.json();
        showResult(result);
      } catch (error) {
        console.error("Fetch éŒ¯èª¤:", error);
        showError(error);
      }
    }

    function showResult(result) {
      loading.classList.add('hidden');
      messageText.textContent = result.message;

      if (result.success) {
        // === å ±åˆ°æˆåŠŸ ===
        messageText.className = "text-2xl font-semibold text-success whitespace-pre-line";
        
        const rawGroup = result.group ? result.group.split('ï¼š')[1] || result.group : "";
        const rawLocation = result.location ? result.location.split('ï¼š')[1] || result.location : "";

        displayGroup.textContent = rawGroup;
        displayLocation.textContent = rawLocation;

        successInfoBox.classList.remove('hidden');
        errorInfo.classList.add('hidden');
        
        actionButtons.classList.remove('hidden');
        reminderText.classList.remove('hidden');

        // (!!! NEW: é¡¯ç¤ºè¬›ç¾©æŒ‰éˆ• !!!)
        handoutLink.classList.remove('hidden');

      } else {
        // === æŸ¥ç„¡æ­¤äºº/éŒ¯èª¤ ===
        messageText.className = "text-2xl font-semibold text-error whitespace-pre-line";
        
        successInfoBox.classList.add('hidden');
        
        if (result.group) {
            groupText.textContent = result.group;
            locationText.textContent = result.location;
            errorInfo.classList.remove('hidden');
        } else {
            errorInfo.classList.add('hidden');
        }
        
        actionButtons.classList.add('hidden');
        reminderText.classList.add('hidden');

        // (!!! NEW: éš±è—è¬›ç¾©æŒ‰éˆ• !!!)
        handoutLink.classList.add('hidden');
      }
      
      resultDiv.classList.remove('hidden');
    }

    function showError(error) {
      loading.classList.add('hidden');
      messageText.textContent = "ç™¼ç”ŸéŒ¯èª¤ï¼š" + error.message;
      messageText.className = "text-2xl font-semibold text-error whitespace-pre-line";
      
      successInfoBox.classList.add('hidden');
      errorInfo.classList.add('hidden');
      actionButtons.classList.add('hidden');
      reminderText.classList.add('hidden');
      // (!!! NEW: éš±è—è¬›ç¾©æŒ‰éˆ• !!!)
      handoutLink.classList.add('hidden');
      
      resultDiv.classList.remove('hidden');
    }

    function resetForm() {
      input.value = '';
      resultDiv.classList.add('hidden');
      form.classList.remove('hidden');
      loading.classList.add('hidden');
      
      displayGroup.textContent = '';
      displayLocation.textContent = '';
      groupText.textContent = '';
      locationText.textContent = '';
      
      successInfoBox.classList.add('hidden');
      errorInfo.classList.add('hidden');
      actionButtons.classList.add('hidden');
      reminderText.classList.add('hidden');
      // (!!! NEW: éš±è—è¬›ç¾©æŒ‰éˆ• !!!)
      handoutLink.classList.add('hidden');
    }

    input.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        document.getElementById('submitButton').click();
      }
    });
  </script>
</body>
</html>
